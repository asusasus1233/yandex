!function(e){var t=e.Sandbox=e.Sandbox||function(t){this.init?this.init(t):e.console&&e.console.error&&e.console.error("Sandbox was just declared but init is not defined yet")};t.ENV={PRODUCTION:"production",TESTING:"testing",DEVELOPMENT:"development"},t.static=function(n,r,i){var s=function(){try{return JSON.parse(localStorage.getItem("debugSandbox"))}catch(e){return!1}}();r&&!s?t.tryCatch(n,i):n.call(e.Sandbox,e,document)},t.async=function(e,t){return setTimeout(e.bind(this),t||0)},t.getEnv=function(){return t.StaticLinks&&t.StaticLinks.BUCKET&&t.StaticLinks.BUCKET.env?t.StaticLinks.BUCKET.env:t.ENV.PRODUCTION},t.getLocation=function(){return e.location},t._getContainer=function(e){var n;return e&&e.container instanceof HTMLElement&&(n=e.container),e&&t.isString(e.container)&&(n=document.querySelector(e.container)),n||(n=document.body),n},t.isUndefined=function(e){return void 0===e},t.isBoolean=function(e){return"boolean"==typeof e},t.isNumber=function(e){return"number"==typeof e&&e===e},t.isString=function(e){return"string"==typeof e},t.isFunction=function(e){return"function"==typeof e},t.isObject=function(e){return Boolean(e)&&"object"==typeof e},t.safeCall=function(e){if(t.isFunction(e)){var n=Array.prototype.slice.call(arguments,1);return e.apply(this,n)}},t.mergeObjects=function(e,n){if(t.isObject(e)||t.isObject(n)){if(Array.isArray(e)||Array.isArray(n))return[].concat(e,n);if(!t.isObject(e))return n;if(!t.isObject(n))return e;var r,i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r]);for(r in n)n.hasOwnProperty(r)&&(i[r]=t.mergeObjects(i[r],n[r]));return i}},t.tryCatch=function(n,r){var i=t.isFunction(r)?r:t.ErrorHandler.handleError,s=t.isFunction(n);try{s&&n.call(e.Sandbox,e,document)}catch(e){i(e)}}}(window),function(){var e=window.Sandbox.StaticLinks={};e.SANDBOX_NAME="vh-player-js",e.VERSION="0x4c6066c8a09",e.BUCKET=function(){return Object({env:"production",url:"//yastatic.net/video-player",bucket:"video-player-static",endpoint:"s3.yandex.net",path:"/0x4c6066c8a09",version:"0x4c6066c8a09"})}(),e.BUCKET.url=("http:"===location.protocol?"http:":"https:")+e.BUCKET.url}(),Sandbox.static(function(e){var t=e.Sandbox,n=t.ErrorHandler=t.ErrorHandler||{};n.createVarsString=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&(e[n]||0===e[n])&&t.push(n+"="+encodeURIComponent(e[n]).replace(/\*/g,"%2A"));return t.join(",")},n.normalizeError=function(e){var n=t.isObject(e.meta)?e.meta:{};try{n.query=decodeURIComponent(t.getLocation().search),n.hash=decodeURIComponent(t.getLocation().hash)}catch(e){}return{env:t.getEnv(),page:t.StaticLinks.SANDBOX_NAME,version:t.StaticLinks.VERSION,level:e.level||"error",reqid:e.reqid||"empty",yandexuid:e.yandexuid,service:e.service,file:e.filename||e.fileName,line:e.lineno||e.lineNumber,col:e.colno||e.colNumber,stack:e.error&&e.error.stack||e.stack||"",message:e.message,additional:n,path:"690.2361",slots:e.slots||""}},n.sendCounter=function(e){var r=["//yandex.ru/clck/jclck","dtype=stred","path="+e.path,"reqid="+e.reqid,"slots="+e.slots,"vars="+n.createVarsString({143:"28.1434","-env":e.env,"-yandexuid":e.yandexuid,"-service":e.service,"-version":e.version,"-page":e.page,"-level":e.level,"-msg":e.message,"-url":e.file,"-line":e.line,"-col":e.col,"-stack":e.stack,"-additional":JSON.stringify(e.additional),"-ua":navigator.userAgent,"-project":"video-player"}),"*"+t.getLocation().href].join("/");n.reportError(r)},n.reportError=function(e){try{-1===navigator.userAgent.indexOf("UCBrowser")&&navigator.sendBeacon&&navigator.sendBeacon(e," ")||(document.createElement("img").src=e)}catch(e){}},n.filterError=function(e){var t=e.stack||e.error&&e.error.stack;return[/\/video-player\/[^\/]*\/?bundles-common\//,/\/video-player\/[^\/]*\/?pages-common\//].some(function(e){return e.test(t)})},n.handleError=function(e){if(n.filterError(e)){var t=n.normalizeError(e);n.sendCounter(t)}},e.addEventListener("error",n.handleError)}),function(e){var t=e.Sandbox;if(t.isES5=function(){"use strict";var t=function(){return Boolean(Date&&Date.prototype&&Date.prototype.toISOString)}(),n=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame,r=e.MutationObserver||e.WebKitMutationObserver,i=document.visibilityState||document.mozVisibilityState||document.msVisibilityState||document.webkitVisibilityState;return Boolean(!this&&Object.create&&Array.isArray&&Function.prototype.bind&&t&&n&&r&&i)}(),t.getDeprecationError=function(){return'<div class="es5-support"><div class="es5-support__container"><div class="es5-support__header">${textHeader}</div><div class="es5-support__paragraph">${textParagraph}</div></div></div>'.replace("${textHeader}","Ваш браузер устарел").replace("${textParagraph}","Он не поддерживает современные веб-стандарты, и поэтому в нём не будет работать плеер. Вы можете обновить свой браузер или установить другой — более современный.")},!t.isES5){var n=function(){};t.static=n,t.init=function(e){return t._getContainer(e).innerHTML=t.getDeprecationError(),this},t.decl=n}}(window),Sandbox.static(function(e){var t=e.Sandbox,n=t.Query=function(e,r,i){var s,o,a={},u={};if(t.isObject(r))for(o in r)r.hasOwnProperty(o)&&(s=r[o],t.isObject(s)?(t.isUndefined(s.value)||(this[o]=s.value),t.isFunction(s.set)&&(a[o]=s.set),s.unsafe&&(u[o]=!0)):t.isUndefined(s)||(this[o]=s));var c,d;if(e){t.isObject(e)||(e=n.parse(e));for(o in e)e.hasOwnProperty(o)&&(c=this[o],a.hasOwnProperty(o)?a[o].call(this,e[o],o):this[o]=e[o],this[o]!==c&&u[o]&&(d=d||{},d[o]=this[o]))}d&&t.isFunction(i)&&i(d,this)},r=n.prototype;r.toString=function(n,r,i){var s,o=e.encodeURIComponent,a=this;n=n||"&",i=i||[];var u=Object.keys(a).filter(function(e){return!t.isUndefined(a[e])}).map(function(e){return s=a[e],t.isObject(s)&&(s=JSON.stringify(s)),i.indexOf(e)>-1?e+"="+s:o(e)+"="+o(s)}).join(n);return r&&(u+=n),u},r.appendTo=function(e){var t=this.toString();return t?(e+=e.indexOf("?")>-1?"&":"?",e+=t):e},n.parse=function(r,i,s){var o={};if(!r||!t.isString(r))return o;"?"!==r[0]&&"#"!==r[0]||(r=r.slice(1));var a,u,c,d,l=e.decodeURIComponent,h=r.split(i||"&");for(d=0;d<h.length;d++)a=h[d].indexOf("="),-1!==a?(u=l(h[d].slice(0,a)),c=l(h[d].slice(a+1)),c=n.parseJSON(c),o[u]=c):s&&(u=l(h[d]),o[u]=!0);return o},n.parseJSON=function(e){try{return JSON.parse(e)}catch(t){return e}}}),Sandbox.static(function(e){var t=e.Sandbox,n=t.Thumb=t.Thumb||{};n.THUMBNAIL_SIZE=[{width:240,height:135,sizeString:"240x135"},{width:320,height:180,sizeString:"320x180"},{width:480,height:270,sizeString:"480x270"},{width:640,height:360,sizeString:"640x360"},{width:936,height:524,sizeString:"936x524"},{width:1920,height:1080,sizeString:"1920x1080"}],n.NAMESPACES=["get-ott","get-vh"],n.getURL=function(e,n,r,i){if(t.isString(e)){if(!n||!r)return e;if(i=(i||0)<1.5?1:2,-1===this.NAMESPACES.indexOf(this._getNamespace(e)))return e;var s=e,o=n<=r?n:r,a=n<=r?"width":"height",u=this.THUMBNAIL_SIZE.reduce(function(e,t){return!e&&o*i<=t[a]?t:e},void 0);return u&&(s=e.replace("orig",u.sizeString)),s}},n._getNamespace=function(e){return e=e.replace(/https?:\/\//i,"").replace(/\/\//i,""),e.split("/")[1]||null}}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";function e(e){var t=this.constructor;return this.then(function(n){return t.resolve(e()).then(function(){return n})},function(n){return t.resolve(e()).then(function(){return t.reject(n)})})}function t(e){return Boolean(e&&void 0!==e.length)}function n(){}function r(e,t){return function(){e.apply(t,arguments)}}function i(e){if(!(this instanceof i))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],d(e,this)}function s(e,t){for(;3===e._state;)e=e._value;if(0===e._state)return void e._deferreds.push(t);e._handled=!0,i._immediateFn(function(){var n=1===e._state?t.onFulfilled:t.onRejected;if(null===n)return void(1===e._state?o:a)(t.promise,e._value);var r;try{r=n(e._value)}catch(e){return void a(t.promise,e)}o(t.promise,r)})}function o(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof i)return e._state=3,e._value=t,void u(e);if("function"==typeof n)return void d(r(n,t),e)}e._state=1,e._value=t,u(e)}catch(t){a(e,t)}}function a(e,t){e._state=2,e._value=t,u(e)}function u(e){2===e._state&&0===e._deferreds.length&&i._immediateFn(function(){e._handled||i._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)s(e,e._deferreds[t]);e._deferreds=null}function c(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function d(e,t){var n=!1;try{e(function(e){n||(n=!0,o(t,e))},function(e){n||(n=!0,a(t,e))})}catch(e){if(n)return;n=!0,a(t,e)}}var l=setTimeout;i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){var r=new this.constructor(n);return s(this,new c(e,t,r)),r},i.prototype.finally=e,i.all=function(e){return new i(function(n,r){function i(e,t){try{if(t&&("object"==typeof t||"function"==typeof t)){var a=t.then;if("function"==typeof a)return void a.call(t,function(t){i(e,t)},r)}s[e]=t,0==--o&&n(s)}catch(e){r(e)}}if(!t(e))return r(new TypeError("Promise.all accepts an array"));var s=Array.prototype.slice.call(e);if(0===s.length)return n([]);for(var o=s.length,a=0;a<s.length;a++)i(a,s[a])})},i.resolve=function(e){return e&&"object"==typeof e&&e.constructor===i?e:new i(function(t){t(e)})},i.reject=function(e){return new i(function(t,n){n(e)})},i.race=function(e){return new i(function(n,r){if(!t(e))return r(new TypeError("Promise.race accepts an array"));for(var s=0,o=e.length;s<o;s++)i.resolve(e[s]).then(n,r)})},i._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){l(e,0)},i._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var h=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();"Promise"in h?h.Promise.prototype.finally||(h.Promise.prototype.finally=e):h.Promise=i}),function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(r,i,function(t){return e[t]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=8)}([function(e,t,n){"use strict";var r,i;t.__esModule=!0,(r=t.ContentTypes||(t.ContentTypes={})).FILM="film",r.TRAILER="trailer",r.CHANNEL="channel",r.MUSIC="music-clip",r.SHORT_VIDEO="short-video",r.OTT_TRAILER="ott-trailer",(i=t.TrackingEvents||(t.TrackingEvents={})).SET_SOURCE="setSource",i.INIT="init",i.START="start",i.END="end",i.PLAY="play",i.PAUSE="pause",i.ERROR="error",i.AD_START="adStart",i.AD_END="adEnd",i.HEARTBEAT="heartbeat",i.WATCHED_TIME="watchedTime",i.VIEWED="viewed"},function(e,t,n){"use strict";t.__esModule=!0;var r=n(2),i=n(3),s=n(0),o={1:"channel-family",2:"channel",3:"episode",4:"vod-library",5:"vod-episode",6:"tv-series",7:"tv-season",8:"black-window",9:"out-of-tv-channel",10:"type-folder",11:"zen-namespace",12:"zen-library",13:"zen-episode",14:"yandex-disribution-library",15:"yandex-disribution-episode",16:"emergency-black-window",17:"cv-black-window",18:"yandex-market-library",19:"yandex-market-episode",20:"ott-movie",21:"ott-episode",22:"kd-feed-episode",24:"sport-episode",25:"announce",30:"ntv-vod-library",31:"ntv-vod-movie",32:"ntv-vod-series",33:"ntv-vod-series-season",34:"ntv-vod-series-season-episode",35:"ott-multipart",36:"ott-part",37:"ott-trailer",38:"ott-collection",39:"ott-collection-item",40:"high-light",41:"user-episode",42:"vod-news",43:"vod-broadcast",44:"vod-news-episode",45:"vod-broadcast-episode",46:"snapshot-tv-episode",47:"kp-trailer",48:"ya-news",49:"self-service-bw-window",50:"main-black-window",51:"music-clip",82:"ott_linked_video",83:"ott_music_karaoke",84:"ott_linked_video_parent",85:"ott_music_karaoke_parent",86:"ott-vod-library",87:"ott_linked_trailer",88:"ott_linked_music_clip",122:"ott-video-episode"},a="content_duration_",u=[["1","content_start"],["10000",a+"10"],["20000",a+"20"],["30000",a+"30"],["40000",a+"40"],["50000",a+"50"],["60000",a+"60"]],c="VIDEO_",d=[["25",c+"25"],["50",c+"50"],["75",c+"75"],["90",c+"90"],["99",c+"END"]];t.default=function(e,t){var n;"contentTypeID"in(n=e)&&(n.contentTypeId=n.contentTypeID),e=function(e){for(var t=0;t<i.TRACKING_DATA_KEYS.length;t++){var n=i.TRACKING_DATA_KEYS[t];void 0===e[n]&&(e[n]="domain"===n?document.location.hostname:"buildTimestamp"===n?Date.now():"-")}return e}(e=n);var a,c,l,h,f,p,_=(a=t.env,(c={testing:{counterId:45961911,kpCounterId:48924764,vpCounterId:45151398},production:{counterId:45913512,kpCounterId:48924740,vpCounterId:31713861}})[a]?c[a]:c.testing),m=(l=t.env,(h={testing:{ottTrackingsBackend:"https://tracking-testing.ott.yandex.net/v1/",metrikaBackend:"//mc.yandex.ru/watch/",redirlogBackend:"https://yandex.ru/clck/jclck/"},production:{ottTrackingsBackend:"https://tracking.ott.yandex.net/v1/",metrikaBackend:"//mc.yandex.ru/watch/",redirlogBackend:"https://yandex.ru/clck/jclck/"}})[l]?h[l]:h.testing),y={},v=e.serviceName,g=(f=e.contentTypeId,p={47:s.ContentTypes.TRAILER,20:s.ContentTypes.FILM,21:s.ContentTypes.FILM,51:s.ContentTypes.MUSIC,87:s.ContentTypes.CHANNEL,88:s.ContentTypes.CHANNEL,122:s.ContentTypes.SHORT_VIDEO,37:s.ContentTypes.OTT_TRAILER},f in p?p[String(f)]:s.ContentTypes.FILM);return(v in i.default[g]?i.default[g][v]:i.default[g].default).forEach(function(e){y[e]=function(e,t,n){var r,i,o,a,c,l,h=[];t===s.ContentTypes.TRAILER?(r="{{metrikaBackend}}{{vpCounterId}}?page-ref=yandex.ru&page-url=goal://{{domain}}/",e===s.TrackingEvents.INIT?h.push('{{metrikaBackend}}{{vpCounterId}}?page-ref=yandex.ru&site-info={"kp_trailers":{"host":{"{{serviceName}}":{"{{kpId}}":{"{{uuid}}":"{{kpTrailerId}}"}}}}}&page-url=goal://{{domain}}/TRAILER_START'):e===s.TrackingEvents.AD_START?h.push(r+"TRAILER_AD_START"):e===s.TrackingEvents.AD_END?h.push(r+"TRAILER_AD_END"):e===s.TrackingEvents.VIEWED&&h.push([r+"TRAILER_50",{percent:50}],[r+"TRAILER_90",{percent:90}])):(i='{{metrikaBackend}}<<COUNTER_NAME>>?page-ref=yandex.ru&site-info={"{{serviceName}}":{"{{fromBlock}}":{"<<EVENT_NAME>>":{"{{uuid}}":{"{{position}}":"{{monetizationModel}}"}}}}}',e!==s.TrackingEvents.SET_SOURCE&&e!==s.TrackingEvents.INIT||(c=(a=i.replace("<<EVENT_NAME>>","video_start")).replace("<<COUNTER_NAME>>","{{counterId}}"),h.push(c+"&page-url=goal://{{domain}}/VIDEO_START"),e===s.TrackingEvents.INIT&&"kp"===n&&(o=a.replace("<<COUNTER_NAME>>","{{kpCounterId}}"),h.push(o+"&page-url=goal://{{domain}}/VIDEO_START"))),e!==s.TrackingEvents.AD_START&&e!==s.TrackingEvents.AD_END||(f=e===s.TrackingEvents.AD_START?"VIDEO_AD_START":"VIDEO_AD_END",c=(a=i.replace("<<EVENT_NAME>>",f)).replace("<<COUNTER_NAME>>","{{counterId}}"),h.push(c),"kp"===n&&(l=a.replace("<<COUNTER_NAME>>","{{kpCounterId}}"),h.push(l))),e===s.TrackingEvents.WATCHED_TIME&&u.forEach(function(e){var t={offset:Number(e[0])},r=i.replace("<<EVENT_NAME>>",e[1]),s=r.replace("<<COUNTER_NAME>>","{{counterId}}");h.push([s,t]),"kp"===n&&h.push([r.replace("<<COUNTER_NAME>>","{{kpCounterId}}"),t])}),e===s.TrackingEvents.VIEWED&&d.forEach(function(e){var t={percent:Number(e[0])},r=(i+"&page-url=goal://{{domain}}/<<EVENT_NAME>>").replace(/<<EVENT_NAME>>/g,e[1]),s=r.replace("<<COUNTER_NAME>>","{{counterId}}");h.push([s,t]),"kp"===n&&h.push([r.replace("<<COUNTER_NAME>>","{{kpCounterId}}"),t])}));var f,p='{{ottTrackingsBackend}}watch?data={"position":"{{position}}","fromBlock":"{{fromBlock}}","serviceName":"{{serviceName}}","uuid":"{{uuid}}","puid":"{{puid}}","sid":"{{sid}}","vSid":"{{vsid}}","yaUID":"{{yandexuid}}","monetizationModel":"{{monetizationModel}}","contentTypeName":"{{contentTypeName}}","device-type":"{{device-type}}","device-type-tns":"{{device-type-tns}}","subscriptionType":"{{subscriptionType}}","page":"{{page}}","testIds":"{{testIds}}","eventId":"{{eventId}}","subProfileId":"{{subProfileId}}","deviceId":"{{deviceId}}","appVersion":"{{appVersion}}","platformOs":"{{platformOs}}","platformVersion":"{{platformVersion}}","platformVendor":"{{platformVendor}}","platformModel":"{{platformModel}}","platformVendorDeviceId":"{{platformVendorDeviceId}}","platformName":"{{platformName}}","psid":"{{psid}}","buildTimestamp":"{{buildTimestamp}}","pathId":"{{pathId}}","fromBlockPosition":"{{fromBlockPosition}}","fromBlockItemPosition":"{{fromBlockItemPosition}}","fromBlockAction":"{{fromBlockAction}}","fromBlockMLSessionId":"{{fromBlockMLSessionId}}","fromBlockStartPage":"{{fromBlockStartPage}}","fromBlockEndPage":"{{fromBlockEndPage}}"';if(e!==s.TrackingEvents.SET_SOURCE&&e!==s.TrackingEvents.INIT||h.push(p+',"eventType":"video_start","eventCount":"-","audio-track-lang":"{{audio-track-lang}}","audio-track-name":"{{audio-track-name}}","text-track-lang":"{{text-track-lang}}","text-track-name":"{{text-track-name}}"}'),e===s.TrackingEvents.ERROR&&h.push(p+',"errorCode":"{{error-code}}","eventType":"player_error","eventCount":"-"}'),e!==s.TrackingEvents.AD_START&&e!==s.TrackingEvents.AD_END||(f=e===s.TrackingEvents.AD_START?"VIDEO_AD_START":"VIDEO_AD_END",h.push(p+',"eventType":"'+f+'","eventCount":"-"}')),e===s.TrackingEvents.HEARTBEAT){var _=void 0;switch(t){case s.ContentTypes.CHANNEL:case s.ContentTypes.SHORT_VIDEO:case s.ContentTypes.OTT_TRAILER:case s.ContentTypes.TRAILER:_=1e4;break;case s.ContentTypes.MUSIC:_=3e4;break;default:_=6e4}h.push([p+',"timestamp":"{{timestamp}}","vts":"{{vts}}","fts":"{{fts}}","fullscreen":"{{fullscreen}}","eventType":"heartbeat","eventCount":"'+_+'","audio-track-name":"{{audio-track-name}}","audio-track-lang":"{{audio-track-lang}}","text-track-name":"{{text-track-name}}","text-track-lang":"{{text-track-lang}}","mute":"{{muted}}"}',{delay:_,offset:_}])}return e===s.TrackingEvents.WATCHED_TIME&&u.forEach(function(e){var t={offset:Number(e[0])};h.push([p+',"eventType":"'+e[1]+'","eventCount":"'+e[0]+'","audio-track-lang":"{{audio-track-lang}}","audio-track-name":"{{audio-track-name}}","text-track-lang":"{{text-track-lang}}","text-track-name":"{{text-track-name}}"}',t])}),e===s.TrackingEvents.VIEWED&&d.forEach(function(e){var t={percent:Number(e[0])};h.push([p+',"eventType":"'+e[1]+'","eventCount":"'+("99"==e[0]?"100":e[0])+'"}',t])}),h}(e,g,v)}),e=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=e[0],r=1;r<e.length;r++){var i=e[r];if("object"==typeof i)for(var s in i)n[s]=i[s]}return n}(e,_,m,{contentTypeName:o[e.contentTypeId]||"unknown"}),{trackingEvents:JSON.parse(r.default(y,e))}}},function(e,t,n){"use strict";t.__esModule=!0;var r="__VAL__";t.default=function(e,t,n){void 0===t&&(t={});var i=(void 0===n?{}:n).macros,s=void 0===i?"{{"+r+"}}":i,o={};Object.keys(t).forEach(function(e){var n=s.replace(r,e);o[n]=t[e]});var a=new RegExp("("+Object.keys(o).join("|")+")","ig");return("string"==typeof e?e:JSON.stringify(e)).replace(a,function(e){return e in o?encodeURI(o[e]):e})}},function(e,t,n){"use strict";t.__esModule=!0;var r=n(0);t.TRACKING_DATA_KEYS=["yandexuid","position","serviceName","reqid","path","sid","uuid","kpId","kpTrailerId","contentTypeId","monetizationModel","subscriptionType","puid","page","domain","vars","testIds","eventId","subProfileId","buildTimestamp","pathId","deviceId","appVersion","platformOs","platformVersion","platformVendor","platformModel","platformVendorDeviceId","platformName","psid","fromBlock","fromBlockPosition","fromBlockItemPosition","fromBlockAction","fromBlockMLSessionId","fromBlockStartPage","fromBlockEndPage"];var i=[r.TrackingEvents.SET_SOURCE,r.TrackingEvents.INIT,r.TrackingEvents.ERROR,r.TrackingEvents.AD_START,r.TrackingEvents.AD_END,r.TrackingEvents.HEARTBEAT,r.TrackingEvents.WATCHED_TIME,r.TrackingEvents.VIEWED],s={film:{default:i,kp:i},trailer:{default:i},channel:{default:i},"music-clip":{default:i},"short-video":{default:i},"ott-trailer":{default:i}};t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){void 0===e&&(e=window),"Ya"in e||(e.Ya={}),"OTT"in e.Ya||(e.Ya.OTT={}),"PlayerLoader"in e.Ya.OTT||(e.Ya.OTT.PlayerLoader={})}},function(e,t,n){"use strict";function r(){}var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},s=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(6)),u=o(n(7)),c=(r.prototype.init=function(e){var t=(e.source||{}).context;if(!t)return this.useBasePlayer(e);var n=t.contentTypeId,r=t.licenses,i=(void 0===r?[]:r)[0];if(i&&!("active"in i))return this.usePlaceholder(e);if(20===n||21===n)return this.useWrapper(e);var s="production"===e.envName?"production":"testing",o=window.Ya.OTT.buildTrackings(e.source.context,{env:s});return e.source.trackings=a.default(o,e.source.trackings),this.useBasePlayer(e,!0)},r.prototype.usePlaceholder=function(e){var t=e.source,n=t.context,r=n.container,o=void 0===r?{}:r,a=n.licenses[0],c=s(n,["container","licenses"]),d=t.preview;e.element="string"==typeof e.element?document.getElementById(e.element):e.element;var l=this.getPlaceholderUrl();return(this.placeholderExists(o)?Promise.resolve():u.default(l,document.head)).then(function(){return window.Ya.OTT.Placeholder.main(i(i(i({container:o,thumbnail:d},c),a),{config:e}))}).then(function(t){return t.render(e.element)})},r.prototype.useBasePlayer=function(e,t){void 0===t&&(t=!1);var n=e.version,r=e.useBetaStatic,i=this.getPlayerBundle(n,r);return(this.baseApiExists()?Promise.resolve():u.default(i,document.head)).then(function(){return window.Ya.playerApi.init(e)}).then(function(e){return{api:e,withWrapper:!1,withTrackings:t}})},r.prototype.useWrapper=function(e){var t=this.getWrapperUrl();return(this.wrapperExists()?Promise.resolve():u.default(t,document.head)).then(function(){return window.Ya.OTT.Player.init(e)}).then(function(e){return{api:e,withWrapper:!0,withTrackings:!0}})},r.prototype.baseApiExists=function(){return!!window.Ya&&!!window.Ya.playerApi},r.prototype.wrapperExists=function(){return!(!window.Ya||!window.Ya.OTT||!window.Ya.OTT.Player)},r.prototype.placeholderExists=function(e){return(void 0===e?{}:e).context,!!(window.Ya&&window.Ya.OTT&&window.Ya.OTT.Placeholder)&&!!window.Ya.OTT.Placeholder.main},r.prototype.getWrapperUrl=function(){return"https://yastatic.net/s3/kinopoisk-frontend/ott/player-wrapper/"+r.WRAPPER_VERSION+"/ott-player-wrapper.js"},r.prototype.getPlaceholderUrl=function(){return"https://yastatic.net/s3/kinopoisk-frontend/ott/player-placeholder/"+r.PLACEHOLDER_VERSION+"/ott-player-placeholder.js"},r.prototype.getPlayerBundle=function(e,t){return("http:"===location.protocol?"http://":"https://")+(t?"betastatic.yastatic.net":"yastatic.net")+(e?"/yandex-video-player-iframe-api-bundles/"+e+"/js/player-api-loader.js":"/yandex-video-player-iframe-api/js/player-api-loader.js")},r.WRAPPER_VERSION="3.9.2",r.PLACEHOLDER_VERSION="1.0.0",r);t.default=c},function(e,t,n){"use strict";function r(e){return i.apply(void 0,e.map(function(e){return{trackingEvents:e}})).trackingEvents}function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[0]?e[0].trackingEvents:{};Array.isArray(n)&&(n=r(n));for(var i=1;i<e.length;i++)!function(t){var i=e[t]?e[t].trackingEvents:{};Array.isArray(i)&&(i=r(i)),Object.keys(i).forEach(function(e){var t=i[e];Array.isArray(t)&&(e in n?Array.isArray(n[e])&&(n[e]=n[e].concat(t)):n[e]=t)})}(i);return{trackingEvents:n}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return new Promise(function(n,r){var i=document.createElement("script");i.type="text/javascript",i.src=e,i.crossOrigin="anonymous",i.onload=n,i.onerror=r,t.appendChild(i)})}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(1)),s=r(n(4)),o=r(n(5));s.default(),window.Ya.OTT.buildTrackings=i.default,window.Ya.OTT.PlayerLoader={init:function(e){return(new o.default).init(e)}}}]),Sandbox.static(function(e,t){var n=e.Sandbox,r=n.Cookies={};r.get=function(t){var n=new RegExp(t+"=([^;]+)","i"),r=this._getCookies(),i=r.match(n);return i&&i[1]?e.decodeURIComponent(i[1]):""},r._getCookies=function(){return t.cookie}}),Sandbox.static(function(e){var t=e.Sandbox,n=t.VHQuery=t.VHQuery||{};n.META_VIEW_MODE={none:0,always:1,start:2,ui:3,restriction_age:4},n.SUBSCRIBE_BUTTON_TYPE={plain:0,colourful:1,with_subscribe_info:2,with_subscribe_label:3},n.PLATFORM=["desktop","touch","pad","app","tv","tvapp"],n.PRESETS=["default","live","paid","avod","alive"],n.isValidPresetName=function(e){return-1!==n.PRESETS.indexOf(e)},n.getQuery=function(e,r){if(!t.isFunction(r))throw new Error("VHQuery: missing method for handling unsafe params.");var i=new t.Query(e,n._getParamsDescriptor(),r.bind(this));return n._postGetQuery(i)},n._postGetQuery=function(e){return e.reqid&&t.isObject(e.counters)&&!e.counters.reqid&&(e.counters.reqid=e.reqid),e.counters&&e.counters.reqid&&!e.reqid&&(e.reqid=e.counters.reqid),(e.tv||e.nativeui||e.test_mode)&&(e.recommendations=""),"zen:article"===e.from&&(e.autoplay=!1),e},n.setAsBoolean=function(e,t){this[t]=Boolean(e)},n.setAsNotRequiredBoolean=function(e,t){this[t]=void 0!==e?Boolean(e):void 0},n.setIsTrue=function(e,t){!0===e&&(this[t]=e)},n.setAsString=function(e,t){e&&(this[t]=String(e))},n.setIsNumber=function(e,n){t.isNumber(e)&&(this[n]=e)},n.setAsNumber=function(e,n){var r=Number(e);this[n]=t.isNumber(r)?r:0},n._getParamsDescriptor=function(){return{from:{value:"other",set:n.setAsString},slots:null,distr_id:null,audio_only:!1,tv:{value:!1,set:n.setAsBoolean},loop:{value:!1,set:n.setAsBoolean},preload:{value:!1,set:n.setAsBoolean},report:{value:!0,set:n.setAsBoolean},preview:{value:!0,set:n.setAsBoolean},preview_src:{value:"",set:n.setAsString},nativeui:{value:!1,set:n.setAsBoolean},use_friendly_frame:{value:!0,set:n.setAsBoolean},branding_intro:{value:!1,set:n.setAsBoolean},restore_playback_progress:{value:!1,set:n.setAsBoolean},remote_progress_saving:{value:!1,set:n.setAsBoolean},progress:{value:!0,set:n.setAsBoolean},start_position_confirmation:{value:!1,set:n.setAsBoolean},force_unmute:{value:!0,set:n.setAsBoolean},stream_cms:{value:!0,set:n.setAsBoolean},beta:{value:!1,set:n.setIsTrue},event_prefix:{value:"",set:n.setAsString},from_block:{value:"other",set:n.setAsString},hidden:{value:"",set:n.setAsString},device_id:{value:"",set:n.setAsString},autoplay:{value:!0,set:function(e,t){0===e&&(this[t]=!1)}},allow_muted:{set:n.setAsBoolean},mute:{value:!1,set:n.setAsNotRequiredBoolean},volume:{set:function(e,n){t.isNumber(e)&&e>=0&&e<=100&&(this[n]=e)}},play_on_visible:{set:function(e,t){this[t]=void 0}},adConfig:{set:function(e,n){t.isObject(e)&&(this[n]=e)},unsafe:!0},streams:{set:function(e,t){Array.isArray(e)&&(this[t]=e)}},vmap_id:{set:n.setAsNumber,unsafe:!0},vmap_scenario_id:{set:this.setAsNumber,unsafe:!0},meta:{value:n.META_VIEW_MODE.none,set:function(e,r){var i=n.META_VIEW_MODE[String(e)];t.isNumber(i)&&(this[r]=i)}},subscribe_button:{value:void 0,set:function(e,r){e=String(e);var i=n.SUBSCRIBE_BUTTON_TYPE[e];t.isNumber(i)&&(this[r]=e)}},m_duration:{value:3e3,set:function(e,n){t.isNumber(e)&&e>=0&&(this[n]=1e3*e)}},m_title:{value:null,set:n.setAsString},m_desc:{value:null,set:n.setAsString},recommendations:{value:"doc2doc",set:function(e,t){this[t]="off"!==e?e:""}},recommendations_count:{value:25,set:function(e,n){t.isNumber(e)&&e>=0&&(this[n]=e)}},recommendations_should_make_set_source:{value:null,set:n.setAsBoolean},recommendations_permanent_titles_visibility:{value:!0,set:n.setAsBoolean},recommendations_only_fullscreen:{value:!1,set:n.setAsBoolean},recommendations_show_on_credits:{value:!1,set:n.setAsBoolean},hide_brand_play_button:{value:!1,set:n.setAsBoolean},live_offset:{set:function(e,n){t.isNumber(e)&&e>=0&&(this[n]=e)}},recommendations_params:{value:{},set:function(e,n){t.isObject(e)&&(this[n]=e)}},platform:{set:function(e,t){n.PLATFORM.indexOf(e)>-1&&(this[t]=e)}},mod:{value:"",set:n.setAsString},t:{set:n.setIsNumber},skippable_fragments:{value:!0,set:n.setAsBoolean},preferable_width:{set:n.setIsNumber},preferable_height:{set:n.setIsNumber},release_timeout:{value:0,set:n.setIsNumber},retpath:{set:n.setAsString},promo_config:{value:{},set:function(e,n){t.isObject(e)&&(this[n]=e)}},ya_station:{value:!0,set:n.setAsBoolean},share:{value:!0,set:n.setAsBoolean},has_preroll:{set:n.setAsBoolean,unsafe:!0},disable_update:{value:!1,set:n.setAsBoolean},velocity_metrics_sampled:{value:!0,set:n.setAsBoolean},test_mode:{value:!1,set:n.setAsBoolean},test_data:{value:"default",set:function(e,t){n.isValidPresetName(e)&&(this[t]=e)}},force_enable_post_message:{set:n.setAsBoolean},cache_sources_count:{set:n.setAsNumber}}}}),Sandbox.static(function(){var e=window.Sandbox,t=e.VHConfig=function(e){this.params=e.params,this.query=e.query,this.ids=e.ids,this.expFlags=e.expFlags,this.container=e.container,this.player=e.player,this.requestInfo=e.requestInfo||{},this.serverError=e.serverError},n=t.prototype;n._prepareVHParams=function(){var t=Object.create(this.params.data.content),n=this.params.data.content.actual_episode;if(n)for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r]);t.stream&&(t.withCredentials=Boolean(t.stream.withCredentials)),t.loop=Boolean(t.loop);var i=this.container.offsetWidth,s=this.container.offsetHeight,o=window.devicePixelRatio;return t.meta&&(t.meta.announce_thumbnail=e.Thumb.getURL(t.meta.announce_thumbnail,i,s,o)),t.thumbnail=e.Thumb.getURL(t.thumbnail,i,s,o),t.onto_poster=e.Thumb.getURL(t.thumbnail,i,s,o),t.cover=e.Thumb.getURL(t.cover,i,s,o),t},n._getHiddenControls=function(t){if(this.query.tv)return"*";var n=[];t.auto_fields&&t.auto_fields.player_controls_hidden&&(n=t.auto_fields.player_controls_hidden);var r=[].concat(n,this.query.hidden.split(","));return Object.keys(r.reduce(function(t,n){return e.isString(n)&&(n=n.trim())&&(t[n]=!0),t},{})).join(", ")},n._getBrandPlayButton=function(e){return Boolean(e.can_play_on_efir&&e.auto_fields&&e.auto_fields.ether_watermark_required&&!this.expFlags.hide_brand_play_button)},n._getLiveOffset=function(t){return e.isNumber(this.query.live_offset)?this.query.live_offset:t.ugc_live?15:void 0},n.isPlayerConfigRequired=function(e){return!this.serverError&&!(e.ugc_live&&("offline"===e.ugc_live_status||"cancelled"===e.ugc_live_status||"ready"===e.ugc_live_status&&!e.reload_on_ready))},n.getSkinConfig=function(e){
var t=this._getShareConfig(e),n=this._getBrandPlayButton(e),r=this._getFeatureParams(e),i=this._getHiddenControls(e),s=this._getLogoConfig(e),o=this._getTitleSettings(),a=this._getSubscribeButton(e);return{showBrandLogo:!1,showReportButton:this.query.report,showUnmuteButtonForAll:this.expFlags.force_unmute,shareConfig:t,showBrandPlayButton:n,logoConfig:s,features:r,hiddenControls:i,showSubscribeButton:a,title:o}},n.getPlayerConfig=function(){var e=this._prepareVHParams();if(this.preparedVHParams=e,!this.isPlayerConfigRequired(e))return e;var t=this.getSourceConfig(e),n=this._getAutoplay(),r=this._getLiveOffset(e),i=this.getSkinConfig(e),s={element:"player-container"+this.ids.id,source:t,skinParams:{skinConfig:i},autoplay:n,volume:this.query.volume,muted:this.query.mute,preload:this.query.preload,platform:this.query.platform,togglePlaybackOnVisibilityChange:this.query.play_on_visible,useAbdBundle:this.requestInfo.use_aab_bundle,useFriendlyFrame:this.query.use_friendly_frame,flags:this.expFlags,usePlayerApiMock:this.query.test_mode,liveOffset:r,slowConnection:this.requestInfo.slow_connection||this.query.slow_connection,maxBufferLength:this.expFlags.max_buffer_length,bandwidthEstimateOffset:this.expFlags.bandwidth_estimate_offset,logUrl:this.requestInfo.use_aab_bundle?this.requestInfo.logging_url:void 0,device:{id:this.query.device_id},forceEnablePostMessage:this.query.force_enable_post_message,cacheSourcesCount:this.query.cache_sources_count,restoreTabSessionPlaybackProgress:this.expFlags.restore_playback_progress,loadSkin:this.query.skin};return this.params.disableOTTPlayerLoader&&(s.disableOTTPlayerLoader=!0),s},n.getSourceConfig=function(t){this._preparePlaybackParams(t),this._prepareAdParams(t);var n=String(this._getStreamParams(t)),r=this._getStreamsConfig(t),i=this._getAdConfig(t),s=this._getVideoInfo(t),o=this._getTrackings(t),a=this._getOTTParams(t),u=this._getStartPosition(t),c=this._getAdditionalParams(t),d=this._getPreview(t),l=this._getPollPromoConfig(),h=this._getPromoConfig(t),f=e.mergeObjects(l,h);r=r.map(function(e){return e.url+=e.url.indexOf("?")>-1?"&":"?",e.url+=n,e});var p={streams:r,adConfig:i,promoConfig:f,videoInfo:s,trackings:o,preview:d,startPosition:u,enableRemoteProgressSaving:this.query.remote_progress_saving||this.expFlags.progress,withCredentials:this.query.with_credentials||t.withCredentials,loop:t.loop||this.query.loop,additionalParams:c,context:a,passportRetpath:this.query.retpath};return this.params.data.scriptedEvents&&(p.scriptedEvents=this.params.data.scriptedEvents),p},n._preparePlaybackParams=function(e){e.start_time=parseInt(e.start_time)||void 0,e.finish_time=parseInt(e.finish_time),e.finish_time=isNaN(e.finish_time)?void 0:e.finish_time-1,e.dvr=parseInt(e.dvr)||void 0},n._prepareAdParams=function(e){e.imp_id=1,e.adConfig&&!e.adConfig.category&&(e.adConfig.category=1017)},n._getStreamParams=function(t){function n(e,t){(e=parseFloat(e))===e&&(this[t]=e)}function r(t,n){e.isUndefined(t)||(this[n]=t)}var i={clid:495,uuid:t.uuid,yandexuid:this.ids.yandexuid,slots:this.query.slots,from:this.query.from,"test-id":this.query["test-id"],audio_only:this.query.audio_only,start:t.start_time,end:t.finish_time,dvr:t.dvr,soft_max_res_height:this.expFlags.soft_max_res_height};return(this.query.with_ad_insertion||this.requestInfo.with_ad_insertion)&&(i.imp_id=t.imp_id,i.video_category_id=t.adConfig.category,i.target_ref=this.ids.bundle,i.partner_id=t.adConfig.partner_id),new e.Query(i,{uuid:{set:function(t,n){e.isString(t)&&(this[n]=t)}},audio_only:{set:function(e,t){e&&(this[t]=1)}},"test-id":{set:n},imp_id:{set:n},video_category_id:{set:n},partner_id:{set:n},yandexuid:{set:r},slots:{set:r},start:{set:r},end:{set:r},dvr:{set:r},target_ref:{set:r},soft_max_res_height:{set:n}})},n._getStreamsConfig=function(e){var t=this.query.streams?this.query.streams:e.streams;return t=(Array.isArray(t)?t:[]).reduce(function(e,t){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);if(!n.url)return e;var i=n.id||"default";return e.defId||(e.defId=i),n.drmConfig=n.drmConfig||n.drm_config||void 0,delete n.id,delete n.options,delete n.drm_config,i===e.defId&&e.result.push(n),e},{result:[],defId:""}).result},n._getAdConfig=function(t){if(this.query.adConfig)return this.query.adConfig;var n=t.adConfig,r=n||{};if(n){r.partnerId=n.partner_id||n.partnerId,r.category=n.category,r.videoContentId=n.video_content_id||n.videoContentId,r.videoContentName=n.video_content_name||n.videoContentName,r.videoGenreId=n.video_genre_id,r.videoGenreName=n.video_genre_name,r.hasPreroll=e.isBoolean(this.query.has_preroll)?this.query.has_preroll:n.hasPreroll,r.distrId=this.query.distr_id||n.distr_id,r.useAdSession=e.isBoolean(this.query.use_ad_session)?this.query.use_ad_session:n.useAdSession;var i=parseInt(r.partnerId);i&&(r.partnerId=i);var s=parseInt(r.category);s&&(r.category=s),n.video_publisher_id&&(r.videoPublisherId=n.video_publisher_id),n.video_publisher_name&&(r.videoPublisherName=n.video_publisher_name)}return this.query.vmap_id&&(r.vmapId=this.query.vmap_id),this.query.vmap_scenario_id&&(r.vmapScenarioId=this.query.vmap_scenario_id),e.isNumber(this.query.preferable_width)&&e.isNumber(this.query.preferable_height)&&(r.preferableAdSize={width:this.query.preferable_width,height:this.query.preferable_height}),r},n._getPollPromoConfig=function(){if(this.expFlags.poll_id){var e=this._parsePythiaCookies();if(e.start>0){if(Date.now()/1e3-e.start<this.expFlags.poll_timeout)return}var t=this._getPollSuffix(e);if(t){var n=this.expFlags.poll_id+t,r=JSON.stringify({theme:"video-banner_survey",duration:30,mediaFiles:[{id:"240.mp4",type:"video/mp4",width:"432",height:"240",bitrate:"992",delivery:"progressive",url:"https://strm.yandex.ru/vh-canvas-converted/get-canvas/video_59c043b9246bfca6a55c8797_169_240p.mp4"}],pythia:{basePath:"https://yandex.ru/poll/video",slug:n,extra:"_theme_=video&from_player=1"}}),i={type:"VPAID",url:"https://yastatic.net/pcode/media/vpaid-pythia-survey-embed.js",adParameters:r},s={preroll:{before:[i]}};return this.expFlags.poll_show_before_midroll&&(s.midroll={before:[i]}),s}}},n._getPollSuffix=function(e){for(var t="ABCDEFGHI".split(""),n=0;n<t.length;n++)if(!e[t[n]])return t[n];return""},n._parsePythiaCookies=function(){var t=e.Cookies.get("yc").match(/pythia\.([a-z0-9:,]+)/i),n={};return t&&t[1].split(",").forEach(function(e){var t=e.split(":");n[t[0]]=Number(t[1])}),n},n._getVideoInfo=function(e){var t=e.adConfig||{},n={videoContentId:e.content_id,videoContentName:e.title,videoPublisherId:t.video_publisher_id||"",videoPublisherName:t.video_publisher_name||""};return n.videoGenreId=String(t.video_genre_id||""),n.videoGenreName=String(e.genres||t.video_genre_name||""),Object.keys(n).reduce(function(e,t){var r=n[t];return r&&(e[t]=r),e},{})},n._getTrackings=function(e){var t=[];e.trackingEvents&&(t=t.concat(e.trackingEvents)),e.stream&&e.stream.trackings&&e.stream.trackings.trackingEvents&&(t=t.concat(e.stream.trackings.trackingEvents));var n=this._getYaVideoTrackings(e);return n&&(t=t.concat(n).filter(Boolean)),{trackingEvents:t}},n._getSubscribeButton=function(){return{type:this.query.subscribe_button}},n._getEfirLink=function(e){return"https://"+(e.auto_fields&&e.auto_fields.sport_content?"yandexsport.ru/":"yandex.ru/")+"efir?stream_id="+e.content_id+"&from_block={{from_block}}_"+this.query.from},n._getShareConfig=function(e){if(this.query.share&&e.can_play_on_efir){if(e.shareConfig)return e.shareConfig;return{link:this._getEfirLink(e)}}},n._getPreview=function(e){return this.query.preview_src?this.query.preview_src:this.query.preview&&!this.query.streams?e.thumbnail:""},n._getFeatureParams=function(e){var t={};return e.skippableFragments&&e.skippableFragments.length&&this.query.skippable_fragments&&(t.SkippableFragments={skippableFragments:e.skippableFragments,autoSkipTimeout:5,buttonTitles:e.skippableFragmentsButtonTitles||{},controlsShowDuration:5}),t},n._getLogoConfig=function(t){if(t.logoConfig)return t.logoConfig;if(e.isObject(t.watermark)&&e.isString(t.watermark.src))return t.watermark},n._getTitleSettings=function(){if(this.query.meta===e.VHQuery.META_VIEW_MODE.none)return null;var t={name:this.query.m_title,description:this.query.m_desc};switch(this.query.meta){case e.VHQuery.META_VIEW_MODE.always:t.isVisible=!0;break;case e.VHQuery.META_VIEW_MODE.start:case e.VHQuery.META_VIEW_MODE.restriction_age:t.isVisible=!0,t.duration=this.query.m_duration;break;case e.VHQuery.META_VIEW_MODE.ui:t.isVisible=!0,t.visibleWithSkinOnly=!0}return t},n._getOTTParams=function(e){var t=e.ottParams;return t?(t.from=this.query.from,t.contentTypeID&&!t.contentTypeId&&(t.contentTypeId=t.contentTypeID),"cover"in e&&(t.cover=e.cover,t.thumbnailLogos=e.thumbnail_logos),t.container={context:this.query.platform||"",init:this._ottTriggerEvent.call(this,"placeholder:init"),mod:this.query.mod,paymentWidget:this._ottTriggerEvent.call(this,"placeholder:pay")},t):null},n._ottTriggerEvent=function(e){var t=this;return function(n){n.event===e&&t.player.trigger(n.event,[n])}},n._getStartPosition=function(t){return e.isNumber(this.query.t)?this.query.t:e.isNumber(t.progress)&&e.isNumber(t.duration)&&t.progress/t.duration>.95?0:this.expFlags.progress&&e.isNumber(t.progress)?t.progress:void 0},n._getYaVideoTrackings=function(t){if(!e.isObject(t)||!e.YaVideoTrackings)return null;var n={from:this.ids.from,from_block:this.ids.fromBlock,reqid:this.ids.reqid,yandexuid:this.ids.yandexuid,content_id:this.ids.contentId,channel_id:t.channel_id,stream_block:this.ids.streamBlock,duration:t.duration};return t.ottParams&&(n.licence=t.ottParams.monetizationModel,n.svod=t.ottParams.subscriptionType),e.YaVideoTrackings.getConfig(n)},n._getAdditionalParams=function(e){var t=e.additionalParams||{};if(this.ids.frontendVhReqid&&(t.frontend_vh_reqid=this.ids.frontendVhReqid),this.ids.reqid&&(t.reqid=this.ids.reqid),(e.puid||this.query.puid)&&(t.puid=e.puid||this.query.puid),e.player_api_v2=!0,e.content_id&&(t.content_id=e.content_id),this.ids.from&&(t.from=this.ids.from),this.ids.fromBlock&&(t.from_block=this.ids.fromBlock),this.ids.slots&&(t.slots=this.ids.slots),this.ids.streamBlock&&(t.stream_block=this.ids.streamBlock),e.channel_id&&(t.channel_id=e.channel_id),!Array.isArray(this.query["brand-safety-categories"])||e.adTags&&e.adTags["brand-safety-categories"]||(t["brand-safety-categories"]=this._prepareCategory("brand-safety-categories")),e.adTags)for(var n in e.adTags)e.adTags.hasOwnProperty(n)&&(t[n]=this._prepareCategory(n,e.adTags[n]));return t.sandboxVersion=this.ids.sandboxVersion,t},n._prepareCategory=function(e,t){var n=Array.isArray(this.query[e]),r=Array.isArray(t),i=null;return n||r?(i=n?r?this.query[e].concat(t):this.query[e]:t,"brand-safety-categories"===e?"["+i.join(",")+"]":i.join("\n")):null},n._getAutoplay=function(){var t=navigator&&navigator.connection&&navigator.connection.saveData,n=this.requestInfo.slow_connection||this.query.slow_connection;return!(this.expFlags.disable_autoplay_slow_connection&&this.expFlags.disable_autoplay_save_data&&n&&t)&&(!(this.expFlags.disable_autoplay_slow_connection&&!this.expFlags.disable_autoplay_save_data&&n)&&(!(!this.expFlags.disable_autoplay_slow_connection&&this.expFlags.disable_autoplay_save_data&&t)&&(e.isBoolean(this.query.allow_muted)?{allowMuted:this.query.allow_muted}:this.query.autoplay)))},n._getPromoConfig=function(){var e=this.query.promo_config;if(e&&"object"==typeof e)return{intro:this._getPromoList(e.intro),preroll:this._getRollPromo(e.preroll),midroll:this._getRollPromo(e.midroll),postroll:this._getRollPromo(e.postroll),inroll:this._getRollPromo(e.inroll),overlaySelfPromo:this._getPromoList(e.overlay)}},n._getPromoUrl=function(e){return"https://yastatic.net/creative/creatives/"+e+"/script.js"},n._getPromo=function(e){if(e&&"object"==typeof e){var t={url:this._getPromoUrl(e.id)};return null!=e.offset&&(t.offset=parseInt(e.offset,10)||0),t}},n._getPromoList=function(e){if(e&&Array.isArray(e))return e.map(this._getPromo.bind(this)).filter(Boolean)},n._getRollPromo=function(e){if(e&&"object"==typeof e)return{before:this._getPromoList(e.before),after:this._getPromoList(e.after)}}}),function(e){var t=e.VH=e.VH||{},n=t.Provider=function(e,t){this._contentId=e,this._tld=this._getTld(t),this._withCredentials=!0,t&&(this._apiHost=t.apiHost)};n.PROTOCOL="http:"===location.protocol?"http:":"https:",n.DEFAULT_TLD="ru",n.DEFAULT_API_HOST="frontend.vh.yandex";var r=n.prototype;r.load=function(e,t){var n=this._getUrl(e,t);return this._getRequest(n)},r.loadTest=function(e){var t=this._getBackendUrl()+"/"+e+"/"+this._contentId+".json";return this._withCredentials=!1,this._getRequest(t)},r._getRequest=function(e){return new Promise(function(t,n){function r(t,r){var i=new Error("VH.Provider: "+t);i.apiUrl=e,i.responseCode=r,n(i)}var i=this,s=new XMLHttpRequest;s.open("GET",e,!0),s.withCredentials=this._withCredentials,s.onload=function(){s.status>=200&&s.status<400&&i._parseJSON(s.responseText,t,r),r("Invalid response data",s.status)},s.onerror=r.bind(this,"No data was received. Check the request"),s.send()}.bind(this))},r._parseJSON=function(e,t,n){try{t(JSON.parse(e))}catch(e){n("Data parsing error")}},r._getUrl=function(t,n){if(e.isString(t)){var r=this._getBackendUrl()+"/"+t;return r+="player"===t?"/"+this._contentId+".json":"",r+=n?"?"+new e.Query(n).toString():""}},r._getBackendUrl=function(){return this._apiHost?n.PROTOCOL+"//"+this._apiHost:n.PROTOCOL+"//"+n.DEFAULT_API_HOST+"."+this._tld},r._getTld=function(t){if(t&&e.isString(t.tld))return t.tld;var r,i=e.getLocation();return i&&e.isString(i.hostname)&&(r=i.hostname.split(".").pop()),r||n.DEFAULT_TLD}}(window.Sandbox),Sandbox.static(function(){function e(e){return new i.Query(e).toString("/",!0,c)}function t(t){if(d&&t.reqid===l)return d;l=t.reqid;var n={reqid:l,yandexuid:t.yandexuid,select_event:"click",cid:73037,pid:197,dtype:"stred",source:t.from,from_block:t.from_block};return t.licence&&(n.licence=t.licence),t.svod&&(n.svod=t.svod),d=o+a+e(n)}function n(){return e({rnd:"{{random}}",fullscreen:"{{fullscreen}}",mute:"{{muted}}",duration:"{{duration}}",timestamp:"{{timestamp}}",user_ts:"{{vts}}",watchedTime:"{{fts}}",vsid:"{{vsid}}"})}function r(r,i){var s={content_id:i.content_id,stream_block:i.stream_block,channel_id:i.channel_id,path:"player-events."+r};return"error"===r&&(s.error_code="{{error-code}}"),"seek"===r&&(s.position_from="{{old-position}}"),t(i)+n()+e(s)+"*"}var i=window.Sandbox,s=i.YaVideoTrackings={},o="http:"===location.protocol?"http:":"https:",a="//yandex.ru/clck/jclck/",u=["init","error","adStart","adEnd","start","play","pause","end","seek"],c=["rnd","fullscreen","mute","duration","timestamp","user_ts","watchedTime","vsid","error_code","position_from"],d="",l="";s._getDeepWatchDelay=function(e){return e<=180?.57*e:e<=1200?72+.17*e:e<=3600?252+.02*e:216+.03*e},s.getConfig=function(e){var t={};return t.heartbeat=[[r("heartbeat",e),{delay:3e4}],[r("deep_watch",e),{delay:1e3*this._getDeepWatchDelay(e.duration),callsCount:1}]],u.forEach(function(n){t[n]=[r(n,e)]}),t}}),Sandbox.static(function(e,t,n){var r=e.Sandbox,i=r.Announce=function(e){return this._toLiveHandlers=[],this._domElem?this:(e.insertAdjacentHTML("beforeEnd",i._createHTML()),this._domElem=e.querySelector(".announce"),this._timeElem=this._domElem.querySelector(".announce__time"),this._labelElem=this._domElem.querySelector(".announce__label"),this._buttonElem=this._domElem.querySelector(".announce__button"),this._contentElem=this._domElem.querySelector(".announce__content"),this._buttonElem&&this._buttonElem.addEventListener("click",this._onButtonClick.bind(this)),this)},s=i.prototype,o={buttonText:"Прямой эфир"};s.setBackground=function(e,t){if(!this._domElem||e===this._background)return this;var r=this;return this._preloadImage(e,function(){r._domElem.style.backgroundImage='url("'+e+'")',r._contentElem.style.backgroundColor=t||"",r._background=e},function(){r._domElem.style="",r._contentElem.style="",r._background=n}),this},s.setLabel=function(e){return this._labelElem&&e!==this._label?(this._labelElem.style.display=e?"inline":"none",this._labelElem.textContent=e,this._label=e,this):this},s.setTime=function(e){if(!this._timeElem)return this;if(this._timeElem.style.display=e?"inline":"none",e){var t=Math.floor((new Date).getTime()/1e3),n=e-t,r=n<3600?i._formatDiff(n):i._formatTime(e);r!==this._formattedTime&&(this._timeElem.textContent=r,this._formattedTime=r)}return this},s.toggleLiveButton=function(e){return this._buttonElem&&(this._buttonElem.style.display=e?"block":"none"),this},s.show=function(){return this._domElem&&this._domElem.classList.remove("announce_hidden"),this},s.hide=function(){return this._domElem&&this._domElem.classList.add("announce_hidden"),this},s.onLiveButtonClick=function(e,t){return"function"==typeof e&&this._toLiveHandlers.push({callback:e,context:t||this}),this},i._createHTML=function(){return'<div class="announce announce_hidden"><div class="announce__content"><div class="announce__text"><span class="announce__label" style="display: none;"></span><span class="announce__time" style="display: none;"></span></div><button class="announce__button" style="display: none;"><span class="announce__button-text">'+o.buttonText+"</span></button></div></div>"},i._preloadedImages={},s._preloadImage=function(e,t,n){if(!e)return void(n&&n());if("boolean"==typeof i._preloadedImages[e])return void(i._preloadedImages[e]?t&&t():n&&n());var r=new Image;t&&(r.onload=function(){i._preloadedImages[e]=!0,t&&t()}),n&&(r.onerror=function(){i._preloadedImages[e]=!1,n&&n()}),r.src=e,function n(s){if("boolean"!=typeof i._preloadedImages[e]&&!(s<=0))return r.complete&&0!==r.naturalHeight?(i._preloadedImages[e]=!0,void(t&&t())):void setTimeout(n.bind(this,s-1),500)}(6)},i._formatDiff=function(e){var t=Math.floor(e/60),n=Math.floor(t/10),r=t%10;if(e<0)return"уже идёт";if(t<1)return"сейчас начнётся";var i="начнётся через "+t;return 1===r&&1!==n?i+" минуту":r>1&&r<5&&1!==n?i+" минуты":i+" минут"},i._formatTime=function(e){var t=new Date(1e3*e),n=new Date,r=n.getFullYear(),i=n.getMonth(),s=n.getDate();if(new Date(r,i,s+3)<t)return"начнётся "+t.toLocaleString();var o=t.getHours(),a=t.getMinutes();return o<10&&(o="0"+o),a<10&&(a="0"+a),new Date(r,i,s+2)<t?"начнётся послезавтра в "+o+":"+a:new Date(r,i,s+1)<t?"начнётся завтра в "+o+":"+a:"начнётся сегодня в "+o+":"+a},s._onButtonClick=function(){for(var e,t=this._toLiveHandlers.length,n=0;n<t;n++)e=this._toLiveHandlers[n],e.callback.call(e.context)}}),Sandbox.static(function(e){var t=e.Sandbox,n=t.Bender=function(e,t){this.__container=e,this._createState(this,t)},r=n.prototype;r._createState=function(e,n){var r=this,i={};for(var s in n)n.hasOwnProperty(s)&&function(e){if(t.isObject(n[e])&&!Array.isArray(n[e])){var s={};return r._createState(s,n[e]),void(i[e]={get:function(){return s}})}i[e]={get:function(){return n[e]},set:function(t){t!==n[e]&&(n[e]=t,r.render())}}}(s);Object.defineProperties(e,i)},r.render=function e(t){if(!t)return void(e.planned||(e.planned=setTimeout(function(){e.call(this,!0),e.planned=!1}.bind(this),50)));e.planned&&(clearTimeout(e.planned),e.planned=!1),this.__container.innerHTML=this.toString()},r.escape=function(e){return e.replace(n.ESCAPE.REGEXP,function(e){return n.ESCAPE.MAP[e]})},n.ESCAPE={REGEXP:/[<>`'"]/g,MAP:{"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;","`":"&#x60;"}}}),Sandbox.static(function(e){var t=e.Sandbox,n=t.ExpFlags={},r=t.VHQuery;n.parse=function(e){var r=n.getDefault(),i=Array.prototype.filter.call(arguments,Boolean).join(";"),s=t.Query.parse(i,";",!0);return new t.Query(s,r)},n.getDefault=function(){return{"videoplayer-version":void 0,version:void 0,force_unmute:{value:void 0,set:r.setAsBoolean},restore_playback_progress:{value:void 0,set:r.setAsBoolean},use_friendly_frame:{value:void 0,set:r.setAsBoolean},progress:{value:void 0,set:r.setAsBoolean},start_position_confirmation:{value:void 0,set:r.setAsBoolean},hide_brand_play_button:{value:void 0,set:r.setAsBoolean},recommendations_redirect_to_efir:{value:void 0,set:r.setAsBoolean},disable_autoplay_slow_connection:{value:!1,set:r.setAsBoolean},disable_autoplay_save_data:{value:!1,set:r.setAsBoolean},max_buffer_length:{value:void 0,set:r.setIsNumber},bandwidth_estimate_offset:{value:void 0,set:r.setIsNumber},soft_max_res_height:{value:void 0,set:r.setIsNumber},poll_id:{value:void 0,set:r.setAsString},poll_timeout:{value:21600,set:r.setIsNumber},poll_show_before_midroll:{value:!1,set:r.setAsBoolean}}}}),Sandbox.static(function(){var e=window.Sandbox;(e.VHError=e.VHError||{}).ACCESS_ERROR_LABELS={no_licenses:{message:"Нет доступных лицензий",code:151},invalid_region:{message:"Трансляция недоступна в вашем регионе",code:153},old_browser:{message:"Ваш браузер не поддерживает проигрывание защищённого видео. Попробуйте открыть ссылку в другом браузере.",code:5},future_vod_release:{message:"Контент будет доступен",code:100},unexpected:{message:"Мы знаем о проблеме и работаем над её решением. Попробуйте обновить страницу через некоторое время.",code:100},unsupported_browser:{message:"Ваш браузер не поддерживает технологии, которые используются для быстрой и удобной загрузки видео. Установите последнюю версию браузера.",code:412},not_found:{message:"Видео по вашей ссылке не существует",code:404}}}),Sandbox.static(function(e){var t=e.Sandbox,n=t.VHVelocityMetrics=function(){this.isPerformanceNowAvailable=Boolean(t.isObject(performance)&&t.isFunction(performance.now)),this.sandboxName=t.StaticLinks.SANDBOX_NAME,this.metrics={},this.logMethod=null,"vh-player"===this.sandboxName&&(this.initSandbox=0,this.dataSource=n.DATA_SOURCES.dataObject)};n.DATA_SOURCES={contentId:"content-id",dataObject:"data-object"},n.METRICS_NAMES={readyPlayerAPI:"ready",startedOrIdle:"start-idle",userReady:"user-ready",posterReady:"poster-ready"};var r=n.prototype;r._setMetric=function(e,t,n){this.metrics[e]||this.isPerformanceNowAvailable&&(this.metrics[e]={value:performance.now(),sendSampled:t,details:n,sent:!1})},r.setLogMethod=function(e){if(t.isFunction(e)){this.logMethod=e;var n=this;for(var r in this.metrics)Object.prototype.hasOwnProperty.call(this.metrics,r)&&function(e,t){setTimeout(function(){n.send(e,t.sendSampled,t.details)})}(r,this.metrics[r])}},r.send=function(e,r,i){if(this._setMetric(e,r,i),t.isFunction(this.logMethod)&&t.isString(e)&&t.isObject(this.metrics[e])&&!this.metrics[e].sent){var s=this.sandboxName+"."+this.dataSource+".";s+=t.isString(i)?n.METRICS_NAMES[e]+"."+i:n.METRICS_NAMES[e];var o={initSubpage:!0,sampled:r};t.isNumber(this.metrics[e].value)&&t.isNumber(this.initSandbox)&&(this.logMethod(s,this.metrics[e].value-this.initSandbox,o),this.metrics[e].sent=!0)}}}),function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(r,i,function(t){return e[t]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s="./src/entry/sandbox.ts")}({"../../node_modules/tslib/tslib.es6.js":function(e,t,n){"use strict";function r(e,t){function n(){this.constructor=e}A(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function i(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}function s(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}function o(e,t){return function(n,r){t(n,r,e)}}function a(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function u(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){e.done?n(e.value):i(e.value).then(o,a)}u((r=r.apply(e,t||[])).next())})}function c(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,s&&(o=2&n[0]?s.return:n[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,s=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(o=u.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){u.label=n[1];break}if(6===n[0]&&u.label<o[1]){u.label=o[1],o=n;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(n);break}o[2]&&u.ops.pop(),u.trys.pop();continue}n=t.call(e,u)}catch(e){n=[6,e],s=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,s,o,a,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a}function d(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}function l(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||(t[n]=e[n])}function h(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function f(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function p(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(f(arguments[t]));return e}function _(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function m(e){return this instanceof m?(this.v=e,this):new m(e)}function y(e,t,n){function r(e){d[e]&&(c[e]=function(t){return new Promise(function(n,r){l.push([e,t,n,r])>1||i(e,t)})})}function i(e,t){try{s(d[e](t))}catch(e){u(l[0][3],e)}}function s(e){e.value instanceof m?Promise.resolve(e.value.v).then(o,a):u(l[0][2],e)}function o(e){i("next",e)}function a(e){i("throw",e)}function u(e,t){e(t),l.shift(),l.length&&i(l[0][0],l[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,d=n.apply(e,t||[]),l=[];return c={},r("next"),r("throw"),r("return"),c[Symbol.asyncIterator]=function(){return this},c}function v(e){function t(t,i){n[t]=e[t]?function(n){return(r=!r)?{value:m(e[t](n)),done:"return"===t}:i?i(n):n}:i}var n,r;return n={},t("next"),t("throw",function(e){throw e}),t("return"),n[Symbol.iterator]=function(){return this},n}function g(e){function t(t){r[t]=e[t]&&function(r){return new Promise(function(i,s){r=e[t](r),n(i,s,r.done,r.value)})}}function n(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=e[Symbol.asyncIterator];return i?i.call(e):(e="function"==typeof h?h(e):e[Symbol.iterator](),r={},t("next"),t("throw"),t("return"),r[Symbol.asyncIterator]=function(){return this},r)}function b(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function S(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function E(e){return e&&e.__esModule?e:{default:e}}function T(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function x(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n}n.r(t),n.d(t,"__extends",function(){return r}),n.d(t,"__assign",function(){return C}),n.d(t,"__rest",function(){return i}),n.d(t,"__decorate",function(){return s}),n.d(t,"__param",function(){return o}),n.d(t,"__metadata",function(){return a}),n.d(t,"__awaiter",function(){return u}),n.d(t,"__generator",function(){return c}),n.d(t,"__createBinding",function(){return d}),n.d(t,"__exportStar",function(){return l}),n.d(t,"__values",function(){return h}),n.d(t,"__read",function(){return f}),n.d(t,"__spread",function(){return p}),n.d(t,"__spreadArrays",function(){return _}),n.d(t,"__await",function(){return m}),n.d(t,"__asyncGenerator",function(){return y}),n.d(t,"__asyncDelegator",function(){return v}),n.d(t,"__asyncValues",function(){return g}),n.d(t,"__makeTemplateObject",function(){return b}),n.d(t,"__importStar",function(){return S}),n.d(t,"__importDefault",function(){return E}),n.d(t,"__classPrivateFieldGet",function(){return T}),n.d(t,"__classPrivateFieldSet",function(){return x});var A=function(e,t){return(A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},C=function(){return C=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},C.apply(this,arguments)}},"../../node_modules/webpack/buildin/global.js":function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},"../../tmpl/common/blocks/i-polyfill/__object-assign/i-polyfill__object-assign.js":function(e,t){!function(){if(!Object.assign){var e=function(e,t){"use strict";if(null===e||void 0===e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(null!==i&&void 0!==i)for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])}return n};try{Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:e})}catch(t){Object.assign=e}}}()},"../../tmpl/stream-react/src/lib/backoff/index.ts":function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.r(t),n.d(t,"Backoff",function(){return i});var i=function(){function e(e){void 0===e&&(e={}),r(this,"reset",function(){this.attempts=0}),r(this,"_reconnectionDelayMin",void 0),r(this,"_reconnectionDelayMax",void 0),r(this,"_reconnectionFactor",void 0),r(this,"_reconnectionJitter",void 0),r(this,"_reconnectionMaxAttempts",void 0),r(this,"_attemptsDone",void 0),this._reconnectionDelayMin=e.reconnectionDelayMin||100,this._reconnectionDelayMax=e.reconnectionDelayMax||1e4,this._reconnectionFactor=e.reconnectionFactor||2,this._reconnectionJitter=e.reconnectionJitter>0&&e.reconnectionJitter<=1?e.reconnectionJitter:0,this._reconnectionMaxAttempts=e.reconnectionMaxAttempts||1/0,this._attemptsDone=0}return e.prototype.duration=function(){
var e=this._reconnectionDelayMin*Math.pow(this._reconnectionFactor,this._attemptsDone++);if(this._reconnectionJitter){var t=Math.random(),n=Math.floor(t*this._reconnectionJitter*e);e=Math.floor(10*t)>=5?e-n:e+n}return Math.abs(Math.min(e,this._reconnectionDelayMax))},e.prototype.shouldRetry=function(){return Boolean(this._attemptsDone<this._reconnectionMaxAttempts)},e}()},"../../tmpl/stream-react/src/lib/error/index.ts":function(e,t,n){"use strict";function r(e){return e instanceof Error}function i(e){return!r(e)}function s(e){return e instanceof SyntaxError}n.r(t),n.d(t,"isError",function(){return r}),n.d(t,"isSyntaxError",function(){return s}),n.d(t,"isNotErrorData",function(){return i})},"../../tmpl/stream-react/src/lib/extractPartialFields/index.ts":function(e,t,n){"use strict";function r(e,t){return t.reduce(function(t,n){return e[n]&&(t[n]=e[n]),t},{})}n.r(t),n.d(t,"extractPartialFields",function(){return r})},"../../tmpl/stream-react/src/lib/parseJSONSafe/index.ts":function(e,t,n){"use strict";function r(e){var t;try{t=JSON.parse(e)}catch(e){return e}return t}n.r(t),n.d(t,"parseJSONSafe",function(){return r})},"../../tmpl/stream-react/src/lib/url/index.ts":function(e,t,n){"use strict";function r(e,t){return e.split("&").reduce(function(e,n){if(!n)return{};var r,i,s=n.match(/([^=]*)=(.*)/);if(s)try{r=decodeURIComponent(s[1]),i=decodeURIComponent(s[2])}catch(t){return e}else{try{r=decodeURIComponent(n)}catch(t){return e}i=""}return r in e&&t?("string"==typeof e[r]&&(e[r]=[e[r]]),e[r].push(i)):e[r]=i,e},{})}function i(e){var t=[];if(!e)return"";for(var n in e)if(e.hasOwnProperty(n)&&void 0!==e[n]&&null!==e[n]){var r=e[n];"object"!=typeof r&&(r=[r]);for(var i=0;i<r.length;++i)t.push(encodeURIComponent(n)+(""!==r[i]?"="+encodeURIComponent(r[i]):""))}return t.length?"?"+t.join("&"):""}function s(e,t){var n,i=e.match(u);if(i?n=i[3].match(c):(i=[],n=e.match(c)),!i&&!n)throw new TypeError('Invalid url "'+e+'"');var s={scheme:i[1]||"",host:i[2]||"",path:n&&n[1]||"",search:n&&n[2]||"",hash:n&&n[3]||"",query:{}};return s.query=r(s.search,t&&t.multi),s}function o(e){var t="";return!e.scheme||!e.host&&e.path||(t+=e.scheme+"://"),e.host&&(e.scheme||(t+="//"),t+=e.host),t&&(e.path&&0!==e.path.indexOf("/")||!e.path)&&"/"!==t.charAt(t.length-1)&&(t+="/"),t+=e.path||"",t+=i(e.query),e.hash&&(t+="#"+e.hash),t}function a(e,t){return e.replace(c,function(e,n,s,o){var a=s?r(s):{};for(var u in t)t.hasOwnProperty(u)&&(a[u]=t[u]);return n+i(a)+(o?"#"+o:"")})}n.r(t),n.d(t,"addQueryToUrl",function(){return a}),n.d(t,"makeUrl",function(){return o}),n.d(t,"parseUrl",function(){return s}),n.d(t,"parseSearch",function(){return r}),n.d(t,"redirectPageToUrl",function(){return d});var u=/^(?:(.*?):)?\/\/([^/?#\s]+)(\/?.*)$/,c=/^(\/?[^?#\s]*)(?:\?([^#]+))?(?:#(.*))?$/,d=function(e){Ya.streamModules.utils.redirectPageToUrl(e)}},"./src/core/index.ts":function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.r(t),n.d(t,"EtherCms",function(){return s});var i=n("./src/modules/init/index.ts"),s=function(){function e(t){if(r(this,"_inited",!1),r(this,"forbidden",{}),r(this,"settings",{exp:{}}),r(this,"apiUrl","https://frontend.vh.yandex.ru/v23/"),r(this,"graphqlUrl","https://frontend.vh.yandex.ru/graphql"),r(this,"_errorLib",{logError:function(e,t){t&&console.error(t),console.log(e)}}),r(this,"_rumLib",{timeEnd:function(e,t){console.log(e,t)},getTime:function(){return Number(new Date)}}),r(this,"_sessionParams",void 0),r(this,"_baseParams",void 0),r(this,"reqparamsCms",void 0),t)return Object.assign(t,this),Object.getOwnPropertyNames(e.prototype).forEach(function(n){"constructor"!==n&&(t.constructor.prototype[n]=e.prototype[n])}),t}return e.prototype.init=function(e){this._inited||(Object(i.init)(this,e),this._inited=!0)},e}()},"./src/entry/sandbox.ts":function(e,t,n){"use strict";n.r(t),function(e){var r=(n("../../tmpl/common/blocks/i-polyfill/__object-assign/i-polyfill__object-assign.js"),n("./src/modules/instance/index.ts"));n.d(t,"etherCmsInstance",function(){return r.etherCmsInstance});var i=n("./src/modules/ajax/index.ts"),s=n("./src/modules/error/index.ts"),o=n("./src/modules/vhnotify/index.ts");Object.assign(r.etherCmsInstance.constructor.prototype,{ajax:i.ajax,onError:s.onError,initXiva:o.initXiva,subscribe:o.subscribe,unsubscribe:o.unsubscribe}),e.Ya=e.Ya||{},e.Ya.streamCms=r.etherCmsInstance}.call(this,n("../../node_modules/webpack/buildin/global.js"))},"./src/modules/ajax/index.ts":function(e,t,n){"use strict";function r(e,t){var n=u.etherCmsInstance.apiUrl,r={serverdata:"/efir/api/appdata",timestamp:"/efir/api/timestamp",channels:"/portal/tvstream_json/channels",player:"".concat(n,"player/").concat(t,".json"),episodes:"".concat(n,"episodes.json"),mychannel:"".concat(n,"mychannel/episodes.json"),doc2doc:"".concat(n,"doc2doc"),feed:"".concat(n,"feed.json"),carousel:"".concat(n,"carousel_videohub.json"),collection:"".concat(n,"collection"),blogger:"".concat(n,"blogger"),live_feed:"".concat(n,"live_feed"),theme:"".concat(n,"theme"),search:"".concat(n,"search"),series_seasons:"".concat(n,"series_seasons.json"),series_episodes:"".concat(n,"series_episodes.json"),my_subscriptions:"".concat(n,"my_subscriptions"),filter_identities:"".concat(n,"filter_identities"),favorites:"".concat(n,"favorites"),top_carousels:"".concat(n,"top_carousels.json")};return r[e]?r[e]:void Object(c.onError)({method:"getApiUrl",message:"wrong api name: "+e,source:"code",meta:{name:e}})}function i(e,t){var n="cms.fetch."+e;u.etherCmsInstance._rumLib.timeEnd(n,t)}function s(e,t){var n,s=u.etherCmsInstance._baseParams,o=["channels","serverdata","timestamp"].indexOf(e)<0,h=t&&t.content_id,f=r(e,h),p=Object(a.__assign)(Object(a.__assign)({},t),s);return f?(t&&t.from&&(p.from=t.from),"serverdata"===e&&(delete p.reqid,delete p.hash),n=u.etherCmsInstance._rumLib.getTime(),Object(d.load)({url:f,name:e,data:p,xhrFields:{withCredentials:!0}}).then(function(t){return n&&i(e,n),o&&Object(l.checkErrors)(t),t})):Promise.reject(Object(c.onError)({message:"ajax: no url"}))}function o(e){var t={};return e&&(t.reqid=e.reqid,t.apphostReqid=e["apphost-reqid"],e["search-reqid"]&&(t.searchReqid=e["search-reqid"])),t}n.r(t),n.d(t,"ajax",function(){return s}),n.d(t,"getMetaToVhError",function(){return o}),n.d(t,"getApiUrl",function(){return r}),n.d(t,"sendFetchTimeMark",function(){return i});var a=n("../../node_modules/tslib/tslib.es6.js"),u=n("./src/modules/instance/index.ts"),c=n("./src/modules/error/index.ts"),d=n("./src/modules/load/index.ts"),l=n("./src/modules/data-error/index.ts")},"./src/modules/data-error/index.ts":function(e,t,n){"use strict";function r(e){var t=e.errors,n={invalid_region:"region",no_licenses:"licenses",old_browser:"browser",future_vod_release:"future_vod"},r=["invalid_region","no_licenses","old_browser"];i.etherCmsInstance.settings.disableFutureVod||r.push("future_vod_release"),r.map(function(r){var s=t&&t[r]?t[r]:[];e.error===r&&e.content&&s.push(e.content.content_id),s.forEach(function(e){i.etherCmsInstance.forbidden[e]=n[r]})})}n.r(t),n.d(t,"checkErrors",function(){return r});var i=n("./src/modules/instance/index.ts")},"./src/modules/error/index.ts":function(e,t,n){"use strict";function r(e,t){var n=Object(s.__assign)(Object(s.__assign)({},t.meta),e.meta),r=Object(a.getSessionParams)();return r&&(n.from=r.from,n.from_block=r.from_block),t.message&&t.message!==e.message&&(e.message=(e.message?e.message+"; ":"")+t.message||""),e.block=e.block||"stream-cms",e.method=e.method||"onError",e.sourceType=e.sourceType||"logic",e.meta=n,Object.assign(t,e),e}function i(e,t,n){t||(t=new Error(e.message||e.method||"onError")),e=r(e,t);var i=function(){e.message===t.message&&delete e.message,o.etherCmsInstance._errorLib.logError(e,t)};return n?setTimeout(i,0):i(),t}n.r(t),n.d(t,"onError",function(){return i}),n.d(t,"getErrorParams",function(){return r});var s=n("../../node_modules/tslib/tslib.es6.js"),o=n("./src/modules/instance/index.ts"),a=n("./src/modules/session/index.ts")},"./src/modules/init/index.ts":function(e,t,n){"use strict";function r(e,t){var n,r;if(t.errorLib&&(e._errorLib=t.errorLib),t.rumLib&&(e._rumLib=t.rumLib),n=t.disabled,r=t.isPartialServerData,t.settings){if(e.settings=t.settings,e.settings.isMorda){var a=e.settings.exp||{};a.ether_graphql=!1,a.ether_graphql_queue=!1}t.settings.apiUrl&&(e.apiUrl=e.settings.apiUrl+"/"),t.settings.graphqlUrl&&(e.graphqlUrl=e.settings.graphqlUrl)}if(!n&&!r&&!t.settings)return void Object(o.onError)({method:"_init",message:"stream-cms._init: no settings !!!"});e.reqparamsCms=t.reqparamsCms||{},e._sessionParams=t.sessionParams,e._baseParams=Object(i.__assign)({},e.reqparamsCms),Object(s.setSessionParams)()}n.r(t),n.d(t,"init",function(){return r});var i=n("../../node_modules/tslib/tslib.es6.js"),s=n("./src/modules/session/index.ts"),o=n("./src/modules/error/index.ts")},"./src/modules/instance/index.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"etherCmsInstance",function(){return s});var r=n("./src/core/index.ts"),i="undefined"!=typeof Ya&&Ya.streamCms,s=new r.EtherCms(i||void 0)},"./src/modules/load/index.ts":function(e,t,n){"use strict";function r(e){return"string"==typeof e}function i(e){var t,n=e.method||"GET";return new Promise(function(i,u){var c="GET"===n?Object(o.addQueryToUrl)(e.url,e.data||{}):e.url,d=new XMLHttpRequest,l=function(t,r){u(Object(a.onError)({message:(e.name?e.name+" ":"")+"load: "+t,method:"load",source:"vh",sourceMethod:e.name,meta:Object(s.__assign)({response:"wrong JSON"===t&&d.responseText,status:d.status},"GET"===n?e.data:{})},r,!0))};d.open(n,c,!0),e.xhrFields&&Object.assign(d,e.xhrFields),d.onload=function(){var e;if(d.status>=200&&d.status<400){if(!d.responseText)return l("empty response");try{return e=JSON.parse(d.responseText),void i(e)}catch(e){return l("wrong JSON",e)}}return l("bad status")},d.onerror=function(){return l("bad response")},"GET"!==n&&(t=r(e.data)?e.data:JSON.stringify(e.data)),d.send(t||"")})}n.r(t),n.d(t,"load",function(){return i});var s=n("../../node_modules/tslib/tslib.es6.js"),o=n("../../tmpl/stream-react/src/lib/url/index.ts"),a=n("./src/modules/error/index.ts")},"./src/modules/session/index.ts":function(e,t,n){"use strict";function r(e){void 0===e&&(e={}),a.etherCmsInstance._sessionParams=Object(s.__assign)(Object(s.__assign)({},a.etherCmsInstance._sessionParams),e),a.etherCmsInstance._baseParams=Object(s.__assign)(Object(s.__assign)({},a.etherCmsInstance._baseParams),Object(o.extractPartialFields)(a.etherCmsInstance._sessionParams,u))}function i(){return a.etherCmsInstance._sessionParams}n.r(t),n.d(t,"setSessionParams",function(){return r}),n.d(t,"getSessionParams",function(){return i});var s=n("../../node_modules/tslib/tslib.es6.js"),o=n("../../tmpl/stream-react/src/lib/extractPartialFields/index.ts"),a=n("./src/modules/instance/index.ts"),u=["reqid","service","from","from_block","locale","hash","distr_id"]},"./src/modules/vhnotify/index.ts":function(e,t,n){"use strict";function r(e){var t=e.detail;Object(S.onError)({message:"xiva closed connection, "+t.errorText,meta:{closeCode:t.closeCode,isFatal:t.isFatal}})}function i(e){return e.handler+"*"+e.id}function s(e,t){E[e]&&E[e].forEach(function(e){return e(t)})}function o(e,t){return Object(S.onError)({message:"error on xiva, vhnotify",source:"vh",sourceMethod:e},t)}function a(e){var t,n=e.detail,r=n.message,a=n.tags,u=n.operation,c=a.filter(function(e){return e!==u})[0],d=i({handler:u,id:c});switch(u){case"streams":if(t=Object(v.parseJSONSafe)(r),Object(g.isError)(t))return void o("streams",t);s(d,t);break;case"viewers":if(t=Object(v.parseJSONSafe)(r),Object(g.isError)(t))return void o("viewers",t);s(d,t)}}function u(){m.addEventListener("message",a)}function c(){m.addEventListener("error",r)}function d(e){if(!e.session||!e.user)return void Object(S.onError)({message:"initXiva: no session or user",method:"initXiva",source:"code",sourceMethod:"xiva",meta:{session:e.session,user:e.user}});var t=Object(y.__assign)(Object(y.__assign)({},x),e);m||(m=new b.Xiva,m.connect(t),c(),u())}function l(e,t){return e+":"+t.join("+")}function h(e){m||Object(S.onError)({message:"Xiva is not inited",source:"code",sourceMethod:"xiva",method:e})}function f(e){m.reconnect({service:l("vhnotify",e)})}function p(e,t){if(h("subscribe"),"function"==typeof t){var n=i(e);E[n]||(E[n]=[],T.push(n),f(T)),E[n].push(t)}}function _(e,t){h("subscribe");var n=i(e),r=E[n];r&&t&&r.splice(r.indexOf(t),1),r.length&&t||(delete E[n],T.splice(T.indexOf(n),1),T.length?f(T):m.disconnect())}n.r(t),n.d(t,"initXiva",function(){return d}),n.d(t,"subscribe",function(){return p}),n.d(t,"unsubscribe",function(){return _});var m,y=n("../../node_modules/tslib/tslib.es6.js"),v=n("../../tmpl/stream-react/src/lib/parseJSONSafe/index.ts"),g=n("../../tmpl/stream-react/src/lib/error/index.ts"),b=n("./src/modules/xiva/index.ts"),S=n("./src/modules/error/index.ts"),E={},T=[],x={service:"vhnotify",client:"ether"}},"./src/modules/xiva/index.ts":function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.r(t),n.d(t,"Xiva",function(){return d});var i=n("../../node_modules/tslib/tslib.es6.js"),s=n("../../tmpl/stream-react/src/lib/url/index.ts"),o=n("../../tmpl/stream-react/src/lib/backoff/index.ts"),a=n("../../tmpl/stream-react/src/lib/parseJSONSafe/index.ts"),u=n("../../tmpl/stream-react/src/lib/error/index.ts"),c={api:"wss://push.yandex.ru/v2/subscribe/websocket",reconnectParams:{reconnectionDelayMin:100,reconnectionDelayMax:1e4,reconnectionFactor:1.5,reconnectionJitter:.1,reconnectionMaxAttempts:1/0}},d=function(){function e(e,t){r(this,"_ws",void 0),r(this,"_apiUrl",void 0),r(this,"_eventer",void 0),r(this,"_sessionParams",void 0),r(this,"_retries",void 0),r(this,"_timerResubscribe",void 0),r(this,"addEventListener",void 0),r(this,"removeEventListener",void 0);var n=t&&t.reconnectParams||c.reconnectParams;this._retries=new o.Backoff(n),this._apiUrl=t&&t.api||c.api,e&&(this._sessionParams=e),this._eventer=document.createDocumentFragment(),this.addEventListener=this._eventer.addEventListener.bind(this._eventer),this.removeEventListener=this._eventer.removeEventListener.bind(this._eventer),this._onOpen=this._onOpen.bind(this),this._onClose=this._onClose.bind(this),this._onMessage=this._onMessage.bind(this),this._onError=this._onError.bind(this)}return e.prototype.connect=function(e){if(!((e=e||this._sessionParams)&&e.user&&e.service))throw new Error("no session params or no user/service on Xiva.init");this._sessionParams=e,this._connect()},e.prototype.reconnect=function(e){this._sessionParams=Object(i.__assign)(Object(i.__assign)({},this._sessionParams),e),this._connect()},e.prototype.disconnect=function(){clearTimeout(this._timerResubscribe),this._unbindeEvents(),this._ws&&(this._ws.close(1e3),this._ws=null)},e.prototype.send=function(e){this._ws.send(e)},e.prototype._connect=function(){"function"==typeof WebSocket&&(this.disconnect(),this._ws=new WebSocket(this._prepareUrl()),this._bindEvents())},e.prototype._prepareUrl=function(){return Object(s.addQueryToUrl)(this._apiUrl,this._sessionParams)},e.prototype._unbindeEvents=function(){var e=this._ws;e&&(e.removeEventListener("open",this._onOpen),e.removeEventListener("close",this._onClose),e.removeEventListener("message",this._onMessage),e.removeEventListener("error",this._onError))},e.prototype._bindEvents=function(){var e=this._ws;e.addEventListener("open",this._onOpen),e.addEventListener("close",this._onClose),e.addEventListener("message",this._onMessage),e.addEventListener("error",this._onError)},e.prototype._onOpen=function(e){this._retries.reset(),this._dispatchEvent(e)},e.prototype._onClose=function(e){var t=this,n=this._retries.shouldRetry();this._ws=null,clearTimeout(this._timerResubscribe),n||setTimeout(function(){t._connect()},this._retries.duration()),this._dispatchEvent(e);var r,i=e.code;1e3!==i&&(r=4400===i||4401===i||4500===i?e.reason:"unknown close code",this._dispatch("xivaError",{closeCode:i,errorText:r,isFatal:n}))},e.prototype._onMessage=function(e){var t=this,n=Object(a.parseJSONSafe)(e.data);return Object(u.isError)(n)?void this._dispatch("error",n):"ping"===n.operation?(clearTimeout(this._timerResubscribe),void(this._timerResubscribe=setTimeout(function(){return t._ws.close(1e3)},1e3*(n["server-interval-sec"]+2)))):void this._dispatch("message",n)},e.prototype._onError=function(e){this._dispatchEvent(e)},e.prototype._dispatch=function(e,t){var n=new CustomEvent(e,{detail:t});this._eventer.dispatchEvent(n)},e.prototype._dispatchEvent=function(e){var t=new CustomEvent(e.type,e);this._eventer.dispatchEvent(t)},e}()}}),Sandbox.static(function(e){var t=e.Sandbox,n=t.VHQuery;n._getParamsDescriptor=function(e){return function(){var n=e();return n.slow_connection={value:!1,set:this.setAsBoolean},n.with_credentials={value:!1,set:this.setIsTrue},n.with_ad_insertion={value:!1,set:this.setIsTrue},n.api_host={value:"",set:this.setAsString},n.tld={value:"",set:this.setAsString},n["brand-safety-categories"]={value:null,set:function(e,n){e=t.Query.parseJSON(e),Array.isArray(e)?this[n]=e:t.isNumber(e)?this[n]=[e]:t.isString(e)&&e&&(this[n]=e.split(","))}},n.use_ad_session={set:this.setAsBoolean},n.disable_unsafe_log={value:!1,set:this.setAsBoolean},n.skin={set:function(e,n){t.isFunction(e)&&(this[n]=e),e||(this[n]=Boolean(e))}},n.play_on_visible={set:function(e,n){if(t.isNumber(e))return void(e>0&&e<=1&&(this[n]={threshold:e}));t.isUndefined(e)||"undefined"===e||(this[n]=Boolean(e))}},n}}(n._getParamsDescriptor)}),Sandbox.static(function(e,t,n){function r(){var e,t;for(t=i.initHandlers.length-1;t>-1;t--)e=i.initHandlers[t],e.calls=e.calls||{},e.calls[this.id]||(e.calls[this.id]=!0,e.call(this))}var i=e.Sandbox,s=i.prototype;i.isUndefined(i._id)&&(i._id=0),i.ALLOWED_METHODS=["play","pause","seek","seekForward","seekBackward","setVolume","mute","unmute","setQuality","getAudioTrack","getAudioTracks","setAudioTrack","sendReportLog","playInrollAd","updateSource","setFullscreen"],i.INIT_TIME=(new Date).getTime(),i.initHandlers=[],i.instances=[],i._isDomReady=!1,s.callMethod=function(e){if(Sandbox.isObject(e)&&Sandbox.isString(e.method)&&0===e.method.indexOf(this.EVENT_PREFIX)){var t,r=e.method.substring(this.EVENT_PREFIX.length);if(i.ALLOWED_METHODS.indexOf(r)<0)return void this._returnMethodResult(r,e.id,n,"Method forbidden");if(!i.isFunction(this[r]))return void this._returnMethodResult(r,e.id,n,"Method was not implemented");try{t=this[r].call(this,e)}catch(t){return void this._returnMethodResult(r,e.id,n,t.message)}if(Sandbox.isObject(t)&&Sandbox.isFunction(t.then)&&Sandbox.isFunction(t.catch))return t.then(function(t){this._returnMethodResult(r,e.id,t)}.bind(this)),void t.catch(function(t){t=Sandbox.isObject(t)?t.message:t,this._returnMethodResult(r,e.id,n,t)}.bind(this));this._returnMethodResult(r,e.id,t)}},s._returnMethodResult=function(e,t,n,r){var i=e+":return",s={};t&&(s.id=t),Sandbox.isUndefined(n)||(s.result=n),r&&(s.error=r),this.trigger(i,s)},s.__props__={EVENT_PREFIX:"sandbox:"},s._isInIframe=function(){return e.top!==e},s.init=function(t){i.clone({source:this.__props__,destination:this});var s;return i.isObject(t)?this.params=t:(s=[e.location.search.slice(1),e.location.hash.slice(1)].filter(Boolean).join("&"),this.params=new Sandbox.Query(s,this.getDefaultParams())),this.useIframe=this._isInIframe(),i.isObject(this.params.counters)&&(this.counters=this.params.counters,this.params.counters=n),this.container=Sandbox._getContainer(this.params),this.id=i._id++,r.call(this),this.on(this.callMethod),i.instances.push(this),this},i.init=function(e){return i._isDomReady||(i._isDomReady=!0),new i(e)},i.decl=function(e,t){var o,a;Sandbox.isFunction(t)&&t.call(e,e);for(o in e)if(e.hasOwnProperty(o)){if(a=e[o],"init"===o&&i.isFunction(a)){i.initHandlers.push(a);continue}if(!i.isFunction(a)){s.__props__[o]=a;continue}s[o]=a}i._isDomReady&&i.instances.forEach(function(e){i.clone({source:s.__props__,destination:e,mergeFunction:function(e,t){return e!==n?e:t}}),r.call(e)})},s.on=function t(n){function r(e){var n=e.data||{};if(i.isString(n))try{n=JSON.parse(n)}catch(e){}for(var r=0;r<t.handlers.length;r++)t.handlers[r].call(s,n)}var s=this;if(t.handlers=t.handlers||[],t.handlers.push(n),!t.listen){if(t.listen=!0,e.addEventListener)return void e.addEventListener("message",r);e.attachEvent("onmessage",r)}},s.trigger=function(t,n){this.rememberEvent(t,n);var r=JSON.parse(JSON.stringify(n||{}));r.event=this.EVENT_PREFIX+t,r=JSON.stringify(r),e.parent.postMessage(r,"*")},s.rememberEvent=function(e,t){this.eventsStory=this.eventsStory||[],this.eventsStory.push([e,t]),this.eventsStory.length>100&&this.eventsStory.shift()},s.getDefaultParams=function(){return{}},i.appendIFrameParams=function(e,t){t&&e&&(e.src=new Sandbox.Query(t).appendTo(e.src))},i.clone=function e(t){var n=t.source,r=t.destination,i=t.mergeFunction||function(e,t){return t};if(Array.isArray(n)){r=r||[];for(var s=0;s<n.length;s++)r[s]=i(r[s],e({source:n[s],mergeFunction:i}));return r}if(Sandbox.isObject(n)){r=r||{};for(var o in n)n.hasOwnProperty(o)&&(r[o]=i(r[o],e({source:n[o],mergeFunction:i})));return r}return n}}),Sandbox.decl({init:function(){setTimeout(this._loadBundles.bind(this),1e3)},getBundles:function(){return[{name:"player-async",exceptCSS:!0}]},_loadBundles:function(){var e=Sandbox.StaticLinks.BUCKET,t=e.url;e.version&&(t+="/"+e.version),t+="/bundles-common";for(var n,r=document.querySelector("head"),i=this.getBundles(),s=0;s<i.length;s++){if("string"==typeof i[s])n={name:i[s],exceptCSS:!1,exceptJS:!1};else{if(!i[s]||"object"!=typeof i[s])continue;n=i[s]}n.exceptCSS||this._loadBundleStyle(r,t+"/"+n.name+"/_"+n.name+".css"),n.exceptJS||this._loadBundleScript(r,t+"/"+n.name+"/_"+n.name+".js")}},_loadBundleStyle:function(e,t){var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.href=t,e.appendChild(n)},_loadBundleScript:function(e,t){var n=document.createElement("script");n.src=t,n.type="text/javascript",n.async="async",e.appendChild(n)}}),Sandbox.static(function(e,t,n){var r=e.Ya=e.Ya||{},i=e.Sandbox,s=i.YaPlayer=function(e,t){function o(){a.state=s.STATE.DESTROYED,a.trigger("PlayerApiAvailable")}this.version=e||n,this.v2=!0,this.bundle=this._getPlayerBundle(t),this.state=s.STATE.UNAVAILABLE,this.withOttTrackings=!1,this.withOttWrapper=!1;var a=this;if(i.isObject(r.streamPlayer))return void o();this._loadScript(this.bundle,o,function(){a.trigger("onError",[{message:"Player unavailable",isFatal:!0}])})};s.METHODS=[],s._proxy=function(e,t,n){return s.METHODS=s.METHODS||[],s.METHODS.push(e),function(){if(!this.isReady())return t;if(n)try{var r=[e].concat(Array.prototype.slice.call(arguments));return this._callThroughDecorators.apply(this,r)}catch(e){return t}return i.isFunction(this.player[e])?this.player[e].apply(this.player,arguments):t}};var o=s.prototype;o.isReady=function(){return!(!this.player||!this._isPlayerReady)&&(this.state===s.STATE.INITED||this.state===s.STATE.SWITCHED)},o.isPlaying=function(){return this.isReady()&&this.player.getState()===s.PLAYING_STATE.PLAYING},o.on=function(e,t,n){var r=this;return i.isObject(e)?(n=t,Object.keys(e).forEach(function(t){r.on(t,e[t],n)}),this):(i.isString(e)&&i.isFunction(t)&&(this._handlers=this._handlers||{},this._handlers[e]=this._handlers[e]||[],this._handlers[e].push({cb:t,ctx:i.isObject(n)?n:this})),this)},o.init=function(e){return this._executeQueue([function(){return this.state===s.STATE.INIT||this.state===s.STATE.INITED||this.state===s.STATE.SWITCH||this.state===s.STATE.SWITCHED||this.state!==s.STATE.UNAVAILABLE&&this.state!==s.STATE.DESTROY&&(this.state=s.STATE.INIT,e=this._prepareConfig(e),this._init(e))}])},o.destroy=function(){return this._executeQueue([function(){return this.state===s.STATE.DESTROY||this.state===s.STATE.DESTROYED||this.state===s.STATE.UNAVAILABLE||this.state!==s.STATE.INIT&&this.state!==s.STATE.SWITCH&&(this.state=s.STATE.DESTROY,this.player?this.player.destroy():void 0)},function(){return this.state=s.STATE.DESTROYED,this.trigger("onDestroy"),!0}])},o.update=function(e){return this._executeQueue([this.destroy,this.init.bind(this,e),function e(){return e.timeout=500,this.state===s.STATE.INITED&&(!!this.player&&(1===this.player.currentPlayingState||(e.count>3||void this.player.play())))}])},o.setSource=function(e){return this.state===s.STATE.SWITCH&&(this.state=s.STATE.INITED),this._executeQueue([function e(){return e.timeout=500,e.count>100?void(e.failed=!0):this.isReady()},function(){var t=this;t.state=s.STATE.SWITCH;var n=t.player.setSource(e);return n=n.then(function(){t.state=s.STATE.SWITCHED}),n=n.catch(function(){t.state=s.STATE.SWITCHED})}])},o.play=s._proxy("play"),o.pause=s._proxy("pause"),o.seek=s._proxy("seek"),o.setVolume=s._proxy("setVolume"),o.setMuted=s._proxy("setMuted"),o.setVideoTrack=s._proxy("setVideoTrack"),o.setAudioTrack=s._proxy("setAudioTrack"),o.setTextTrack=s._proxy("setTextTrack"),o.insertInto=s._proxy("insertInto",Promise.resolve()),o.openReportWindow=s._proxy("openReportWindow"),o.requestDebugInfo=s._proxy("requestDebugInfo"),o.sendReportLog=s._proxy("sendReportLog",new Error("API unavailable")),o.setVideoStyle=s._proxy("setVideoStyle"),o.setNativeAdControlsVisibility=s._proxy("setNativeAdControlsVisibility"),o.setPlaybackRate=s._proxy("setPlaybackRate"),o.skipAdPod=s._proxy("skipAdPod"),o.playInrollAd=s._proxy("playInrollAd",new Error("API unavailable"),!0),o.getState=s._proxy("getState"),o._getPlayerBundle=function(e){return("http:"===location.protocol?"http://":"https://")+(e?"betastatic.yastatic.net":"yastatic.net")+(this.version?"/yandex-video-player-iframe-api-bundles/"+this.version+"/js/player-api-loader.js":"/yandex-video-player-iframe-api/js/player-api-loader.js")},s._loadedScripts={},o._loadScript=function(e,n,r){if("boolean"==typeof s._loadedScripts[e])return void(s._loadedScripts[e]?n():r());var i=t.createElement("script");i.onload=function(){s._loadedScripts[e]=!0,n()},i.onerror=function(){s._loadedScripts[e]=!1,r()},i.src=e,t.head.appendChild(i)},o.trigger=function(e,t){if(this._handlers&&this._handlers[e]){var n,r=this._handlers[e];t=t||[];for(var i=0;i<r.length;i++)n=r[i],n.cb.apply(n.ctx,t)}},o._getEnvName=function(){return i.getEnv()===i.ENV.PRODUCTION?i.ENV.PRODUCTION:i.ENV.TESTING},o._callThroughDecorators=function(e){for(var t=Array.prototype.slice.call(arguments,1),n=this.player;n&&!i.isFunction(n[e]);)n=n.instance||n.api;return n[e].apply(n,t)},o._prepareConfig=function(e){return e.version=this.version,e.envName=this._getEnvName(),e},o._init=function(e){var t,n=this;return this.player=null,this.skin=null,this.withOttWrapper=!1,this.withOttTrackings=!1,e.disableOTTPlayerLoader?(delete e.disableOTTPlayerLoader,t=r.playerApi.init(e).then(function(e){n.player=e})):t=r.OTT.PlayerLoader.init(e).then(function(e){n.player=e.api,n.withOttWrapper=e.withWrapper,n.withOttTrackings=e.withTrackings}),t=t.then(function(){n.player&&n.player.on("SkinReady",function(){n.skin=n.player.skin}),n.state=s.STATE.INITED,n._bindEvents(),n.trigger("PlayerApiAvailable"),n.trigger("onSourceChange",e.source)}),t=t.catch(function(e){if(n.state=s.STATE.DESTROYED,e)return Promise.reject(new Error(e.message))})},o._bindEvents=function(){var e=this;e.player&&Object.keys(s.EVENTS_TO_V1).forEach(function(t){e.player.on(t,function(){var n=s.EVENTS_TO_V1[t],r=Array.prototype.slice.call(arguments);r=i.isFunction(n.map)?n.map.apply(e.player,r):r,r=Array.isArray(r)?r:[r],e.trigger.call(e,n.name,r)})})},o._executeQueue=function(e,t){return e.forEach(function(e){e.count=0}),new Promise(this._startCurrentStage.bind(this,e,t||0))},o._startCurrentStage=function(e,t,n,r){e[t].count=(e[t].count||0)+1;var s=e[t].call(this);if(s&&(t++,i.isFunction(s.then)&&i.isFunction(s.catch)))return void this._startStageOnPromise(s,e,t,n,r);this._startStageOnTimeout(e,t,n,r)},o._startStageOnPromise=function(e,t,n,r,i){var s=this;e.then(function(){if(n>=t.length)return void r(s);s._startCurrentStage(t,n,r,i)}).catch(i)},o._startStageOnTimeout=function(e,t,n,r){return t>=e.length?void n(this):e[t].failed?void r(e[t].name+" failed"):void setTimeout(this._startCurrentStage.bind(this,e,t,n,r),e[t].timeout||0)},s.STATE={UNAVAILABLE:0,INIT:1,INITED:2,SWITCH:5,SWITCHED:6,DESTROY:3,DESTROYED:4},s.PLAYING_STATE={play:1,pause:2,buffering:3,end:0},s.AD_STATE={PLAYING:1,NOT_PLAYING:2},s.EVENTS=["onReady","onStateChange","onAdStateChange","onVideoTrackChange","onVideoTracksChange","onAudioTrackChange","onAudioTracksChange","onTextTrackChange","onTextTracksChange","onSeek","onError","onCurrentTimeChange","onDurationChange","onFullScreenChange","onVolumeChange","onUserAction","onDVRChange","onSourceChange","onContentImpression","onResourcesIdle","onAdPodStart","onVideoSizeChange","onSubscribeButtonClick","onUserReady","onPosterReady"],s.EVENTS_TO_V1={Ready:{name:"onReady"},ResourcesIdle:{name:"onResourcesIdle"},ContentImpression:{name:"onContentImpression"},SourceChange:{name:"onSourceChange"},PlaybackRateChange:{name:"PlaybackRateChange"},AdPodStart:{name:"AdPodStart"},AdPodCloseStateChange:{name:"AdPodCloseStateChange"},UserReady:{name:"onUserReady"},PosterReady:{name:"onPosterReady"},AdPodCurrentTimeChange:{name:"AdPodCurrentTimeChange"},AdPodTimeToSkipChange:{name:"AdPodTimeToSkipChange"},AdVolumeAvailabilityStateChange:{name:"AdVolumeAvailabilityStateChange"},AdSkippableStateChange:{name:"AdSkippableStateChange"},PlaybackRateRangeChange:{name:"PlaybackRateRangeChange"},NextAdRemainingTimeChange:{name:"NextAdRemainingTimeChange"},PlayingStateChange:{name:"onStateChange",map:function(e){return s.PLAYING_STATE[e.playingState]}},CurrentTimeChange:{name:"onCurrentTimeChange",map:function(e){var t=this.getState(),r=i.isObject(t)?t.watchedTime:n;return[e.currentTime,0,r]}},DurationChange:{name:"onDurationChange",map:function(e){return e.duration}},MutedChange:{name:"onVolumeChange",map:function(e){var t=this.getState();return e&&!e.muted?100*(t?t.volume:0):0}},FullscreenStateChange:{name:"onFullScreenChange",map:function(e){return e.isFullscreen}},VideoTracksChange:{name:"onVideoTracksChange",map:function(e){return[e.videoTracks]}},VideoTrackChange:{name:"onVideoTrackChange",map:function(e){return e.videoTrack}},AudioTracksChange:{name:"onAudioTracksChange",map:function(e){return[e.audioTracks]}},AudioTrackChange:{name:"onAudioTrackChange",map:function(e){return e.audioTrack}},TextTracksChange:{name:"onTextTracksChange",map:function(e){return[e.textTracks]}},TextTrackChange:{name:"onTextTrackChange",map:function(e){return e.textTrack}},AdStateChange:{name:"onAdStateChange",map:function(e){return e.adState}},Error:{name:"onError",map:function(e){return e.error}},SkinReady:{name:"SkinReady"}}}),Sandbox.static(function(e,t,n){var r=e.Sandbox,i=r.AnnounceRelease=function(e){i.GUID=i.GUID||0,i.GUID++;var n="announce-release"+i.GUID;this._container=e,this._container.insertAdjacentHTML("beforeEnd",'<div id="'+n+'"></div>'),this._store=new r.Bender(t.getElementById(n),{hidden:!0,small:!1,background:"",shadowColor:"",title:"",subTitle:"Мы можем напомнить, чтобы вы не забыли его посмотреть",release:{month:null,day:null,time:null},link:{text:"Подписаться в Яндекс Эфире",videoId:""}}),this._store.toString=this.template},s=i.prototype;s.template=function(){if(this.hidden)return"";var e={NONE:'style="display: none;"',INLINE:'style="display: inline;"',BLOCK:'style="display: block;"'},t={announceClasses:"",announceStyle:"",contentStyle:"",badgeStyle:e.NONE,monthContent:"",dayContent:"",titleStyle:e.NONE,titleContent:"",timeStyle:e.NONE,timeContent:"",subTitleStyle:e.NONE,subTitleContent:"",buttonAttrs:e.NONE,buttonContent:""};if(this.background&&(t.announceStyle='style="background-image: url(${url});"'.replace("${url}",this.escape(this.background))),this.shadowColor&&(t.contentStyle='style="background-color: ${color};"'.replace("${color}",this.escape(this.shadowColor))),
this.title&&(t.titleStyle=e.INLINE,t.titleContent=this.escape(this.title)),this.subTitle&&(t.subTitleContent=this.subTitle),this.release.month&&this.release.day&&(t.badgeStyle=e.BLOCK,t.monthContent=this.release.month,t.dayContent=this.release.day),this.release.time&&(t.timeStyle=e.INLINE,t.timeContent=this.release.time),this.link.videoId){var n="https://yandex.ru/efir/?stream_id="+this.link.videoId+"&from=efir&from_block=videohub";t.buttonAttrs="",t.buttonAttrs+=' href="${url}"'.replace("${url}",n),t.buttonAttrs+=' target="_blank"',t.buttonAttrs+=" "+e.BLOCK,t.subTitleStyle=e.BLOCK}return this.link.text&&(t.buttonContent=this.link.text),this.small&&(t.announceClasses="announce-release_small",t.badgeStyle=e.NONE,t.timeStyle=e.BLOCK,t.subTitleStyle=e.NONE,t.buttonAttrs=e.NONE),Object.keys(t).reduce(function(e,n){return e.replace("${"+n+"}",t[n])},'<div class="announce-release ${announceClasses}" ${announceStyle}><div class="announce-release__content" ${contentStyle}><div class="announce-release__badge" ${badgeStyle}><div class="announce-release__month">${monthContent}</div><div class="announce-release__day">${dayContent}</div></div><div class="announce-release__text"><div class="announce-release__title" ${titleStyle}>${titleContent}</div><span class="announce-release__time" ${timeStyle}> ${timeContent}</span><div class="announce-release__sub-title" ${subTitleStyle}>${subTitleContent}</div></div><a class="announce-release__button" ${buttonAttrs}><span class="announce-release__button-text">${buttonContent}</span></a></div></div>')},s.isFutureDate=function(e){return!!e&&e>Math.floor(Date.now()/1e3)},s.setBackground=function(e,t){return this._store.background=e,this._store.shadowColor=t,this},s.setLabel=function(e){return this._store.title=e,this},s.setTime=function(e){return this._time=r.isNumber(e)&&e>0?e:0,this},s.setVideoId=function(e){return this._store.link.videoId=e,this},s.onStart=function(e,t){return this._onStartCallback=e.bind(t),this},s.update=function(){if(this._store.hidden)return this;if(this._diff=this._time-Math.floor(Date.now()/1e3),this._diff<1)return this._onStartCallback&&(this._onStartCallback(),this._store.hidden=!0),this;this._store.release.time=this._diff<3600?i._formatDiff(this._diff):i._formatTime(this._time);var e=new Date(1e3*this._time);this._store.release.month=e.toLocaleString("ru",{month:"short"}).replace(".",""),this._store.release.day=e.getDate(),this._store.small=this._isSmall();var t=this._diff<7200?1e3*this._diff/2:36e5;return setTimeout(this.update.bind(this),t),this},s.show=function(){return this._store.hidden=!1,this.update(),this},s.hide=function(){return this._store.hidden=!0,this},s._isSmall=function(){return this._container.clientWidth<450||this._container.clientHeight<300},i._formatDiff=function(e){var t=Math.floor(e/60),n=Math.floor(t/10),r=t%10;if(e<0)return"уже идёт";if(t<1)return"сейчас начнётся";var i="через "+t;return 1===r&&1!==n?i+" минуту":r>1&&r<5&&1!==n?i+" минуты":i+" минут"},i._formatTime=function(e){var t=new Date(1e3*e),n=new Date,r=n.getFullYear(),i=n.getMonth(),s=n.getDate();if(new Date(r,i,s+3)<t){var o={month:"long",day:"numeric",hour:"numeric",minute:"numeric"};return t.toLocaleString("ru",o).replace(",","")}var a=t.getHours(),u=t.getMinutes();return a<10&&(a="0"+a),u<10&&(u="0"+u),new Date(r,i,s+2)<t?"послезавтра в "+a+":"+u:new Date(r,i,s+1)<t?"завтра в "+a+":"+u:"сегодня в "+a+":"+u}}),Sandbox.decl({PLAYER_EVENTS_SUPPORTED:!0,REPLACE_ENDED_EVENT:!1,YANDEX_DOMAINS:["yandex.ru","yandex.com","yandex.net","yandex.com.tr","yandex.com.ge","yandex.com.am","yandex.co.il","yandex.ua","yandex.by","yandex.kz","yandex.uz","yandex.az","yandex.kg","yandex.lv","yandex.lt","yandex.md","yandex.tj","yandex.tm","yandex.fr","yandex.ee","yastatic.net","yandex.st","yandex-team.ru","yandex-team.com","yandex-team.com.ua","yandex-team.net.ua","yandex-team.com.tr","ya.ru","chef.yandex","yadi.sk","kinopoisk.ru","kinopoisk.ua","kinopoisk.by","kinopoisk.tel","iframe-toloka.com"],UGC_LIVE:{STATUS:{offline:"offline",ready:"ready",onair:"onair",finished:"finished",cancelled:"cancelled"},TEXT:{cancelled:"Трансляция отменена",offline:"Трансляция ещё не началась"}},MAX_RETRIES_COUNT:1,documentWasAlwaysActive:!0,_isPlayerDead:!0,init:function(){this._vhPlayerInit(this);var e,t;Sandbox.isUndefined(document.hidden)?Sandbox.isUndefined(document.webkitHidden)||(e="webkitHidden",t="webkitvisibilitychange"):(e="hidden",t="visibilitychange");var n=this;e&&t&&(this.documentWasAlwaysActive=!document[e],document.addEventListener(t,function(){n.documentWasAlwaysActive&&(n.documentWasAlwaysActive=!1)}))},_vhPlayerInit:function(e){if(!Sandbox.isObject(this.params))return void(this.creatingPromise=Promise.reject(new Error("Invalid sandbox params")));var t=Sandbox.isObject(this.params.queryConfig)?this.params.queryConfig:this._getLocationSearch();this.query=Sandbox.VHQuery.getQuery(t,this._logUnsafeQueryParams.bind(this)),this.counters=this.query.counters,this.EVENT_PREFIX=this.query.event_prefix;var n;if(this.query.test_mode){var r=this.query.test_data,i=Sandbox.presets&&Sandbox.presets[r];if(i)n=Promise.resolve(i);else{n=new Sandbox.VH.Provider(r,{apiHost:"playerweb-stands.s3.yandex.net"}).loadTest("mediabox-test-presets")}}else n=Promise.resolve(this.params.data);n=n.then(function(e){this.params.data=e,this.data=e.content,this.userData=e.user_data,this.serverError=e.error,this.requestInfo=e.request_info||{},this.expFlags=Sandbox.ExpFlags.parse(this.requestInfo.flags,this.query.mb_flags),this._validateExpFlags(this.expFlags),this.query.release_timeout&&(this.data.release_date=Math.floor(Date.now()/1e3+this.query.release_timeout)),this.player=new Sandbox.YaPlayer(this.expFlags.version,this.query.beta),this.player.on(this._playerEventAdapters,this),this.player.on(this._ottPlaceHolderEventAdapters,this),this.player.isAd=!1,this.ids=this._getIds(),this._videoDuration=Number.MAX_VALUE,this.retriesCount=0,this.defaultSkin=Sandbox.isUndefined(this.query.skin),this.isOnAir=!1,this.xivaSubscribed=!1,this.viewersNumberUgcLive=null,this.streamCms=this.query.stream_cms?Ya.streamCms:void 0,this.query.test_mode||(this.vhVelocityMetrics=new Sandbox.VHVelocityMetrics),this.streamCms&&this.streamCms.init({settings:{},sessionParams:{reqid:this.ids.reqid,service:this.query.service,from:this.query.from},errorLib:{logError:this._logError.bind(this)}}),this._initContainer()}.bind(this)),this.creatingPromise=n.then(function(){return e.initPlayer()})},getBundles:function(e){return function(){var t=e&&e.call(this);return this.serverError?t:(t=Array.isArray(t)?t:[],this.query.recommendations&&"service"!==this.query.recommendations&&t.push({name:"ya-recommendations",exceptCSS:!0}),t)}}(Sandbox.prototype.getBundles),trigger:function(e){return function(t,n){return n=n||{},this.player.isReady()&&(n.isMuted=this.player.getState().muted,Sandbox.isUndefined(n.time)&&(n.time=this.player.getState().currentTime)),e.call(this,t,n)}}(Sandbox.prototype.trigger),initPlayer:function(e){e&&(this.params=e,this.data=e.data.content,this.serverError=e.data.error),e&&e.queryConfig&&(this.query=Sandbox.VHQuery.getQuery(e.queryConfig,this._logUnsafeQueryParams.bind(this)),this.counters=this.query.counters),this.data.ottParams&&Sandbox.isNumber(this.data.restriction_age)&&(this.query.meta=Sandbox.VHQuery.META_VIEW_MODE.restriction_age,this.query.m_duration=8e3,this.query.m_title=this.data.restriction_age+"+"),this.vhConfig=new Sandbox.VHConfig(this);var t=this.vhConfig.getPlayerConfig(),n=this._getAnnounce(),r=this._getAnnounceRelease();if(this.data.release_date=parseInt(this.data.release_date,10),this.serverError)return this._showAccessError(this.serverError,t.thumbnail),Promise.resolve();if(this.data.ugc_live){if(this.isOnAir)return Promise.resolve();if(this.viewersNumberUgcLive=Sandbox.isNumber(this.data.viewers)?this.data.viewers:this.viewersNumberUgcLive,this.xivaSubscribed||this._subscribeXiva(t.thumbnail),this.isOnAir=this.data.ugc_live_status===this.UGC_LIVE.STATUS.onair,this.data.ugc_live_status===this.UGC_LIVE.STATUS.cancelled)return this._showUGCAnnounce(t.thumbnail,this.UGC_LIVE.TEXT.cancelled),Promise.resolve();if(this.data.ugc_live_status===this.UGC_LIVE.STATUS.offline||this.data.ugc_live_status===this.UGC_LIVE.STATUS.ready&&!this.data.reload_on_ready)return this._showUGCAnnounce(t.thumbnail,this.UGC_LIVE.TEXT.offline),Promise.resolve();if(!this.data.streams)return this._logError({message:"UGC-live: no streams",level:"error"}),this._showAccessError(Sandbox.VHError.ACCESS_ERROR_LABELS.unexpected,t.thumbnail),Promise.resolve()}return Sandbox.isObject(this.counters)&&(this.counters.licence=t.source.context&&Sandbox.isString(t.source.context.monetizationModel)?t.source.context.monetizationModel:"",this.counters.svod=t.source.context&&Sandbox.isString(t.source.context.subscriptionType)?t.source.context.subscriptionType:""),r&&r.isFutureDate(this.data.release_date)?(r.setBackground(this.data.thumbnail,"rgba(41, 43, 58, .6)").setTime(this.data.release_date).setLabel(this.data.title).setVideoId(this.data.can_play_on_efir?this.data.content_id:"").onStart(this.initPlayer,this).show(),Promise.resolve()):(t.source.update=this._getVHData.bind(this),this.player.init(t).then(function(){n&&n.hide()}))},_subscribeXiva:function(e){this.streamCms&&(this.streamCms.initXiva({session:this.ids.reqid,user:this.ids.yandexuid||"anonim"}),this.streamCms.subscribe({handler:"streams",id:this.data.xiva_id},this._onMessageStreams.bind(this,e)),this.streamCms.subscribe({handler:"viewers",id:this.data.xiva_id},this._onMessageViewers.bind(this)),this.xivaSubscribed=!0)},_onMessageStreams:function(e,t){function n(e){r.player.isReady()&&r.destroyPlayer();var t=r._getAnnounce();t&&t.hide(),r.initPlayer({data:e})}if(t&&t.content&&(this.player.trigger("onLiveStatusChanged",[t.content.ugc_live_status]),this.ids.ugcLiveStatus=t.content.ugc_live_status,!this.isOnAir)){if(t.content.ugc_live_status===this.UGC_LIVE.STATUS.cancelled)return void this._showUGCAnnounce(e,this.UGC_LIVE.TEXT.cancelled);var r=this;if(t.content.ugc_live_status===this.UGC_LIVE.STATUS.onair&&n(t),t.content.ugc_live_status===this.UGC_LIVE.STATUS.ready&&this.data.reload_on_ready){new Sandbox.VH.Provider(this.data.content_id,{apiHost:this.query.api_host}).load("player",this.query).then(function(e){n(e)})}}},_onMessageViewers:function(e){e&&e.viewers&&(this.viewersNumberUgcLive=e.viewers,this.player.trigger("onViewersNumberChanged",[e.viewers]),this.trigger("viewersNumberChanged",e.viewers))},destroyPlayer:function(){return this._hasPlayerStarted=!1,this._isPlayerDead=!0,this.xivaSubscribed&&(this.streamCms.unsubscribe({handler:"streams",id:this.data.xiva_id}),this.streamCms.unsubscribe({handler:"viewers",id:this.data.xiva_id}),this.xivaSubscribed=!1),this.player.destroy()},updatePlayer:function(e){e&&(this.data=e.data.content,this.userData=e.data.user_data,this.serverError=e.data.error);var t=this.vhConfig.getPlayerConfig();return this.serverError?(this._showAccessError(this.serverError,t.thumbnail),this.destroyPlayer(),Promise.resolve()):(Sandbox.isObject(this.counters)&&(this.counters.licence=t.source.context&&Sandbox.isString(t.source.context.monetizationModel)?t.source.context.monetizationModel:"",this.counters.svod=t.source.context&&Sandbox.isString(t.source.context.subscriptionType)?t.source.context.subscriptionType:""),t.autoplay=!0,this.player.update(t))},updateSource:function(e){var t=e.id,n=e.params,r=new Sandbox.VH.Provider(t),i=this;r.load("player",n).then(function(e){var t,r={data:e,queryConfig:n};!i.player||i.serverError?t=i.creatingPromise=i.initPlayer(r):i.player.isReady()?t=i.setSourcePlayer(r).then(function(){i.trigger("inited")}):(i.player.destroy(),t=i.creatingPromise=i.initPlayer(r)),t.catch(function(){if(i.serverError){var t=i.vhConfig.getPlayerConfig();i.announce=void 0,i._showAccessError(i.serverError,t.thumbnail)}i.onError("Can not set source for player",e)})}).catch(function(){i.onError("Can not load source for player",e)})},_prepareVHData:function(e){this._hasPlayerStarted=!1,this.params=e,this.data=this.params.data.content,this.serverError=this.params.data.error;var t=e.queryConfig;return t&&(this.query=Sandbox.VHQuery.getQuery(t,this._logUnsafeQueryParams.bind(this))),this.data.ottParams&&Sandbox.isNumber(this.data.restriction_age)&&(this.query.meta=Sandbox.VHQuery.META_VIEW_MODE.restriction_age,this.query.m_duration=8e3,this.query.m_title=this.data.restriction_age+"+"),this.vhConfig=new Sandbox.VHConfig(this),this.vhConfig._prepareVHParams()},_prepareSourceConfig:function(e){if(this.serverError)return this._showAccessError(this.serverError,e.thumbnail),void this.pause();var t=this.vhConfig.getSourceConfig(e);return t.update=this._getVHData.bind(this),t},setSourcePlayer:function(e){var t=this._prepareVHData(e),n=this._prepareSourceConfig(t);if(!n)return Promise.reject();this.setSourcePromise=this.player.setSource(n),this.defaultSkin&&this.player.skin.reconfigure(this.vhConfig.getSkinConfig(t));var r=this;return r.query&&Sandbox.isObject(r.query.counters)&&(this.setSourcePromise=this.setSourcePromise.then(function(){r.counters=r.query.counters,r.initCounters(),Sandbox.Timer.reset()})),this.query.autoplay&&(this.setSourcePromise=this.setSourcePromise.then(function(){r.player.play()})),this.setSourcePromise},_getVHData:function(){if(!(this.retriesCount>=this.MAX_RETRIES_COUNT||this.query.disable_update)){var e=new Sandbox.VH.Provider(this.ids.contentId,{apiHost:this.query.api_host}),t=e.load("player",this.query),n=this;return t=t.then(function(e){var t=n._prepareVHData({data:e});return n._prepareSourceConfig(t)}),this.retriesCount++,t}},_playerEventAdapters:{onReady:function(e){this._player_api=e,this.query.test_mode||(this.vhVelocityMetrics.setLogMethod(this._player_api.logDelta.bind(this._player_api)),this.vhVelocityMetrics.send("readyPlayerAPI",this.query.velocity_metrics_sampled)),this.player._isPlayerReady=!0,this._isPlayerDead=!1,this.trigger("inited")},onStateChange:function(e){switch(e){case Sandbox.YaPlayer.PLAYING_STATE.play:var t=this._hasPlayerStarted?"resumed":"started",n=this.player.getState(),r=Sandbox.isObject(n)?n.duration:void 0;if(this.trigger(t,{duration:r}),this.query.meta===Sandbox.VHQuery.META_VIEW_MODE.restriction_age&&this.player.skin&&this.defaultSkin&&(this._previousState===Sandbox.YaPlayer.PLAYING_STATE.pause||!this._previousState)){var i=this.vhConfig._getTitleSettings();this.player.skin.configure({title:i}),clearTimeout(this._setTitleTimeout),this._setTitleTimeout=setTimeout(function(){this.player.skin.configure({title:{isVisible:!1}})}.bind(this),this.query.m_duration)}this._hasPlayerStarted=!0;break;case Sandbox.YaPlayer.PLAYING_STATE.pause:this.trigger("paused");break;case Sandbox.YaPlayer.PLAYING_STATE.end:this.onEnded(),this.trigger(this.REPLACE_ENDED_EVENT?"paused":"ended")}this._previousState=e},onSeek:function(e){this.trigger("rewound",{time:e.newPosition,previousTime:e.oldPosition})},onAdStateChange:function(e){switch(e.state){case Sandbox.YaPlayer.AD_STATE.PLAYING:this.trigger("adShown");break;case Sandbox.YaPlayer.AD_STATE.NOT_PLAYING:this.trigger("adEnd")}},onAdPodStart:function(e){this.trigger("adPodStart",{adConfig:e&&e.adConfig,adType:e&&e.type})},onCurrentTimeChange:function(e,t,n){this.player.isReady()&&this.trigger("timeupdate",{time:e,utcTime:t,watchedTime:n,duration:this.player.getState().duration})},onVolumeChange:function(e){this.player.isReady()&&this.trigger("volumechange",{volume:e/100,muted:this.player.getState().muted})},onDurationChange:function(e){Sandbox.isNumber(e)&&e>0&&this.trigger("durationchange",{duration:e}),this._videoDuration=e},onVideoTracksChange:function(){this.setQuality({quality:this.query.maxQuality})},onError:function(e){e=e||{},e.isFatal&&(this.onError("Player API shut down after errors",{errorCode:e.details&&e.details.errorCode?e.details.errorCode:e.code,messageCode:e.details?e.details.messageCode:"",message:e.message,playerSrc:e.details?e.details.src:""}),this.trigger("error",{code:e.code})),e.isAccessError&&(this._logError({message:"Data error",meta:{errorCode:e.code,message:e.message},level:"warning"}),this.trigger("error",{code:e.code,message:e.message}))},onResourcesIdle:function(){this.trigger("resourcesIdle"),this.query.test_mode||this.vhVelocityMetrics.send("startedOrIdle",this.query.velocity_metrics_sampled)},onContentImpression:function(){this.query.test_mode||this.vhVelocityMetrics.send("startedOrIdle",this.query.velocity_metrics_sampled),this.trigger("contentImpression"),this.retriesCount=0},onUserReady:function(e){!this.query.test_mode&&this.documentWasAlwaysActive&&this.vhVelocityMetrics.send("userReady",this.query.velocity_metrics_sampled,e.type)},onPosterReady:function(){!this.query.test_mode&&this.documentWasAlwaysActive&&this.vhVelocityMetrics.send("posterReady",this.query.velocity_metrics_sampled)},onDestroy:function(){this._cleanPlayerContainer()},onVideoSizeChange:function(e){if(e&&0!==e.videoWidth&&0!==e.videoHeight){var t=this.player.getState(),n=t?t.adState:void 0,r={videoHeight:e.videoHeight,videoWidth:e.videoWidth,isAd:!!Sandbox.isObject(n)&&n.state===Sandbox.YaPlayer.AD_STATE.PLAYING};this.trigger("sizeChange",r)}},SkinReady:function(){if(this.defaultSkin){this.player.skin.updateExternalPlayerConfig(this.data.yastation_cast_cfg),this.query.meta!==Sandbox.VHQuery.META_VIEW_MODE.start&&this.query.meta!==Sandbox.VHQuery.META_VIEW_MODE.restriction_age||(this._setTitleTimeout=setTimeout(function(){this.player.skin.configure({title:{isVisible:!1}})}.bind(this),this.query.m_duration));var e=this;this.player.skin.on("SubscribeButtonClick",function(){e.trigger("svodSubscribe"),e.setFullscreen(!1)})}}},_ottPlaceHolderEventAdapters:{"placeholder:init":function(e){this.trigger("placeholder:init",e)},"placeholder:pay":function(e){this.trigger("placeholder:pay",e)}},setAudioTrack:function(e){Sandbox.isString(e)&&this.player.setAudioTrack(e),Sandbox.isObject(e)&&this.player.setAudioTrack(e.value)},seek:function(e){Sandbox.isNumber(e)&&this.player.seek(e),Sandbox.isObject(e)&&this.player.seek(e.time)},seekForward:function(e){if(this.player.isReady()){var t=this.player.getState().currentTime,n=e&&e.interval||10;this.player.seek(t+n)}},seekBackward:function(e){if(this.player.isReady()){var t=this.player.getState().currentTime,n=e&&e.interval||10;this.player.seek(t-n)}},setVolume:function(e){if(Sandbox.isNumber(e)&&this.player.setVolume(e),Sandbox.isObject(e)){var t=e.volume>=0&&e.volume<=1?100*e.volume:e.volume;this.player.setVolume(t)}},mute:function(){this.setMuted(!0)},unmute:function(){this.setMuted(!1)},setQuality:function(e){var t={small:"240p",medium:"360p",large:"480p",hd720:"720p",hd1080:"1080p"},n=t[e.quality]||e.quality,r=this.player.getState(),i=r?r.videoTracks:[],s=i.filter(function(e){return e.name===n})[0];s&&s.value&&this.player.setVideoTrack(s.value)},setFullscreen:function(e){function t(){(Sandbox.isObject(e)?e.fullscreen:e)?n.player.skin.requestFullscreen():n.player.skin.exitFullscreen()}if(this.defaultSkin){var n=this;this.player.skin?t():this.player.on("SkinReady",t)}},getAudioTrack:function(){if(this.player.isReady())return this.player.getState().audioTrack},getAudioTracks:function(){if(this.player.isReady())return this.player.getState().audioTracks},getAdState:function(){if(this.player.isReady())return this.player.getState().adState},getDuration:function(){if(this.player.isReady())return this.player.getState().duration},getVersion:function(){if(this.player.isReady())return this.player.getState().version},getMuted:function(){if(this.player.isReady())return this.player.getState().muted},getVolume:function(){if(this.player.isReady())return 100*this.player.getState().volume},setHiddenControls:function(e){function t(){n.player.skin.configure({hiddenControls:e})}if(this.defaultSkin&&this.player&&Sandbox.isString(e)){var n=this;this.player.skin?t():this.player.on("SkinReady",t)}},insertInto:function(e){var t=Sandbox._getContainer({container:e});if(t===this.container)return Promise.resolve();if(t===document.body)throw new Error("А container for moving the player was not found");t.innerHTML="";for(var n=this._getInnerContainer(),r=this.createContainer("inner-container"),i="player-container"+this.id,s=Boolean(this.player.player)&&this.player.state!==Sandbox.YaPlayer.STATE.DESTROY&&this.player.state!==Sandbox.YaPlayer.STATE.DESTROYED,o=0;o<n.childNodes.length;o++)s&&n.childNodes[o].id===i||(r.appendChild(n.childNodes[o]),o--);t.appendChild(r);var a=this.container;return this.container=t,s?this.player.insertInto(r).then(function(){a.innerHTML=""}):(a.innerHTML="",Promise.resolve())},getViewersNumber:function(){return Sandbox.isNumber(this.viewersNumberUgcLive)?this.viewersNumberUgcLive:null},getUGCLiveStatus:function(){return this.ids.ugcLiveStatus},createContainer:function(e){var t=document.createElement("div");return t.id=e+this.id,this.params.disableStyles?(t.style.width="100%",t.style.height="100%"):t.className=e,t},onEnded:function(){},onError:function(e,t){this._isPlayerDead=!0,this._logError({message:e,meta:t,level:"error"})},_logError:function(e){var t=new Error(e.message);t.yandexuid=this.ids.yandexuid,t.reqid=this.ids.reqid,t.service=this.ids.from,t.level=e.level,t.slots=this.ids.slots,t.meta=e.meta||{},t.meta.vsid=this.ids.vsid,t.meta.puid=this.ids.puid,t.meta.contentId=this.ids.contentId,t.meta.fromBlock=this.ids.fromBlock,t.meta.streamBlock=this.ids.streamBlock,t.meta.isPlayerBeta=this.ids.isPlayerBeta,t.meta.v2=this.ids.v2,t.meta.playerVersion=this.ids.playerVersion,t.meta.ottWrapperEnabled=this.player.withOttWrapper,t.meta.ottTrackingsEnabled=this.player.withOttTrackings,Sandbox.ErrorHandler.handleError(t)},_getLocationSearch:function(){return location.search},_getAncestorOrigins:function(){return window.location.ancestorOrigins},_getLocationProtocol:function(){return window.location.protocol},_getDocumentReferrer:function(){return document.referrer},_logUnsafeQueryParams:function(e,t){t&&t.disable_unsafe_log||setTimeout(this._logError.bind(this,{message:"Service uses unsafe params",meta:{host:this._getDomain(),unsafeParams:e},level:"warning"}),1e3)},_validateExpFlags:function(e){e.version=e["videoplayer-version"]||this.query.version,e.progress=Sandbox.isBoolean(e.progress)?e.progress:this.query.progress,e.start_position_confirmation=Sandbox.isBoolean(e.start_position_confirmation)?e.start_position_confirmation:this.query.start_position_confirmation,e.force_unmute=Sandbox.isBoolean(e.force_unmute)?e.force_unmute:this.query.force_unmute,e.restore_playback_progress=Sandbox.isBoolean(e.restore_playback_progress)?e.restore_playback_progress:this.query.restore_playback_progress,e.hide_brand_play_button=Sandbox.isBoolean(e.hide_brand_play_button)?e.hide_brand_play_button:this.query.hide_brand_play_button},_getIds:function(){var e=this,t={yandexuid:Sandbox.Cookies.get("yandexuid"),reqid:this.query.reqid,from:this.query.from,isPlayerBeta:this.query.beta,v2:this.player.v2,id:this.id,bundle:this.player.bundle,sandboxVersion:Sandbox.StaticLinks.VERSION,ugcLiveStatus:this.data.ugc_live_status,slots:this.requestInfo.slots,frontendVhReqid:this.params.data["apphost-reqid"]||this.userData&&this.userData.req_id};return!t.reqid&&this.counters&&(t.reqid=this.counters.reqid),!t.reqid&&this.userData&&(t.reqid=this.userData.req_id),t.reqid||(t.reqid=""),Object.defineProperties(t,{playerVersion:{enumerable:!0,get:function(){var t=e.player.getState();if(t)return t.version}},contentId:{enumerable:!0,get:function(){return e.data.actual_episode?e.data.actual_episode.content_id:e.data.content_id}},vsid:{enumerable:!0,get:function(){var t=e.player.getState();if(t)return t.vsid}},puid:{enumerable:!0,get:function(){return e.data.actual_episode?e.data.actual_episode.puid:e.data.puid}},fromBlock:{enumerable:!0,get:function(){return e.query.from_block}},streamBlock:{enumerable:!0,get:function(){return e.query.stream_block||e.data.streamBlock}}}),t},_getInnerContainer:function(){return this.container.querySelector("#inner-container"+this.id)},_getAnnounceContainer:function(){return document.getElementById("announce-container"+this.id)},_getPlayerContainer:function(){return document.getElementById("player-container"+this.id)},_cleanPlayerContainer:function(){var e=this._getPlayerContainer();null!==e&&(e.innerHTML="")},_cleanInnerContainer:function(){var e=this._getInnerContainer();null!==e&&(e.innerHTML="")},_initContainer:function(){if(this.params.disableStyles)return void(this.container.innerHTML='<div id="inner-container'+this.id+'"style="width: 100%; height: 100%;"><div id="player-container'+this.id+'"style="width: 100%; height: 100%;"></div><div id="announce-container'+this.id+'"></div></div>');this.container.innerHTML='<div id="inner-container'+this.id+'"class="inner-container"><div id="player-container'+this.id+'"class="player-container"></div><div id="announce-container'+this.id+'"class="announce-container"></div></div>',this.container===document.body&&(document.documentElement.style.backgroundColor="#000",document.body.style.backgroundColor="#000")},_getTopUrl:function(){var e=this._getAncestorOrigins();if(e&&e.length)return e[e.length-1];var t=this._getDocumentReferrer();return t||""},_getDomain:function(){return this._getTopUrl().replace(/https?:\/\//i,"").split(/[/?#]/)[0]},_isYandex:function(){if(!this.useIframe)return!0;var e=this._getDomain();return!!e&&this.YANDEX_DOMAINS.some(function(t){var n="."+t;return t===e||e.substring(e.length-n.length,e.length)===n})},_showAccessError:function(e,t){var n=Sandbox.VHError.ACCESS_ERROR_LABELS[e]||Sandbox.VHError.ACCESS_ERROR_LABELS.unexpected,e={isAccessError:!0,code:n.code,message:n.message},r=this._getAnnounce();r&&r.setTime(!1).setLabel(e.message).toggleLiveButton(!1).setBackground(t).show(),this._playerEventAdapters.onError.call(this,e)},_showUGCAnnounce:function(e,t){var n=this._getAnnounce();return n&&n.setLabel(t).toggleLiveButton(!1).setBackground(e).show(),n},_getAnnounce:function(){if(Sandbox.Announce){var e=this._getAnnounceContainer();if(null!==e)return this.announce||(this.announce=new Sandbox.Announce(e)),this.announce}},_getAnnounceRelease:function(){if(Sandbox.AnnounceRelease){var e=this._getPlayerContainer();if(null!==e)return this.announceRelease||(this.announceRelease=new Sandbox.AnnounceRelease(e)),this.announceRelease}}},function(e){if(Sandbox.YaPlayer&&Array.isArray(Sandbox.YaPlayer.METHODS)){var t=["setAudioTrack","seek","setVolume","setQuality","insertInto"];Sandbox.YaPlayer.METHODS.forEach(function(n){t.indexOf(n)>-1||(e[n]=function(){return this.player[n].apply(this.player,arguments)})})}}),Sandbox.static(function(e,t){var n=e.Ya=e.Ya||{},r=n.VH=n.VH||{},i=e.Sandbox=e.Sandbox||{};i.presets={};var s=r.Error=function(e,t){Error.call(this,e.message),this.message=e.message,e.apiUrl&&(this.apiUrl=e.apiUrl),this.documentation="https://wiki.yandex-team.ru/video/sandbox/error-vh-player-js/",Error.captureStackTrace?Error.captureStackTrace(this,r.init):this.stack=(new Error).stack,t&&(this.level=t.level,this.service=t.service,this.meta={},this.meta.reason=t.reason)};s.prototype=Object.create(Error.prototype);var o=r.PlayerJS=function(e,n,r){if((e=Sandbox._getContainer({container:e}))===t.body)throw new s(new Error("Container was not found"));this._container=e,this._sandboxInstance=null,this._contentId=null,this._promise=null,n&&(this.update(n,r),this._contentId=n)},a=o.prototype;a._vhReject=function(e){var t=new s(new Error(e));return i.ErrorHandler.handleError(t),Promise.reject(t)},a.update=function(e,t){if(!e||!i.isString(e)&&!i.isObject(e))return this._promise=this._vhReject("Incorrect data format"),this._promise;Sandbox.isObject(performance)&&Sandbox.isFunction(performance.now)&&(this._initJSAPI=performance.now());var n,r=this._augmentVHQueryConfig(t);if(r&&r.test_mode){var o=i.VHQuery.isValidPresetName(r.test_data),a=o?r.test_data:"default";return i.isObject(i.presets[a])?this._update(i.presets[a],r):(n=new i.VH.Provider(a,{apiHost:"playerweb-stands.s3.yandex.net"}),this._promise=n.loadTest("mediabox-test-presets").then(function(e){return i.presets[a]=e,this._update(e,r)}.bind(this)),this._promise)}if(i.isString(e)){if(this._dataSource=Sandbox.VHVelocityMetrics.DATA_SOURCES.contentId,n=this._promise,e===this._contentId&&n)return n;n=new i.VH.Provider(e,{apiHost:Sandbox.isObject(r)?r.api_host:void 0,tld:Sandbox.isObject(r)?r.tld:void 0}),this._contentId=e;var u=this;return this._promise=n.load("player",r).then(function(e){return u._update(e,r)}).catch(function(e){var t=new s(e,{service:r&&r.from?r.from:"other"}),n=Sandbox.isNumber(e.responseCode)?u._getErrorLabel(e.responseCode):"";return e&&n?(u._sandboxInstance=i.init({data:{error:n,content:{}},container:u._container}),Promise.reject(t)):(i.ErrorHandler.handleError(t),Promise.reject(t))}),this._promise}if(Sandbox.isObject(e)){this._dataSource=Sandbox.VHVelocityMetrics.DATA_SOURCES.dataObject;var c=this.validateData(e);if(c){var d=new s(new Error(c),{service:r&&r.from?r.from:"other"});return this._promise=Promise.reject(d),this._promise}return this._contentId===e.content.content_id?(this._promise=Promise.resolve(this._sandboxInstance),this._promise):(this._contentId=e.content.content_id,this._promise=this._update(e,r),this._promise)}},a._update=function(e,t){var n={data:e,container:this._container,queryConfig:t},r=this,o=this._sandboxInstance;return o&&o.creatingPromise&&!o._isPlayerDead?o.creatingPromise.then(function(){return o.setSourcePlayer(n).then(function(){return o})}):new Promise(function(e,a){var u=setTimeout(function(){a(new s(new Error("Player loading error")))},15e3);return o=i.init(n),r._sandboxInstance=o,o.creatingPromise.then(function(){t&&!t.test_mode&&(r._sandboxInstance.vhVelocityMetrics.initSandbox=r._initJSAPI,r._sandboxInstance.vhVelocityMetrics.dataSource=r._dataSource),clearTimeout(u),o._isPlayerReady?e(o):o.player.on("onReady",function(){e(o)})}).catch(function(e){clearTimeout(u),a(e)})})},a.validateData=function(e){var t="";return i.isObject(e.content)?i.isString(e.content.content_id)?i.isObject(e.user_data)?i.isObject(e.request_info)?Array.isArray(e.content.streams)||e.error||e.content.ugc_live||(t="data.content.streams"):t='"request_info"':t='"user_data"':t="content.content_id":t='"content"',t?"Invalid data format: missing a required field "+t:""},a.insertInto=function(e){var t=this;if(t._sandboxInstance)return t._sandboxInstance.insertInto(e).then(function(){t._container=e});var n=new s(new Error("VH.PlayerJS: Failed to move player"));return Sandbox.ErrorHandler.handleError(n),Promise.reject(n)},a.getViewersNumber=function(){var e=this;return this._promise.then(function(){return e._sandboxInstance.getViewersNumber()}).catch(function(e){var t=new s(new Error("VH.PlayerJS: Failed to get the number of users"),{reason:e});return Sandbox.ErrorHandler.handleError(t),Promise.reject(t)})},a.getUGCLiveStatus=function(){var e=this;return this._promise.then(function(){return e._sandboxInstance.getUGCLiveStatus()}).catch(function(e){var t=new s(new Error("VH.PlayerJS: Failed to get status of ugc live"),{reason:e});return Sandbox.ErrorHandler.handleError(t),Promise.reject(t)})},a.on=function(e){this._promise.then(function(){this._sandboxInstance.player.on(e)}.bind(this)).catch(function(e){var t=new s(new Error("VH.PlayerJS: Failed to subscribe to player and sandbox events"),{level:"warning",reason:e});Sandbox.ErrorHandler.handleError(t)})},a.destroy=function(){var e=this;return this._promise.then(function(){return e._sandboxInstance.destroyPlayer().then(function(){e._sandboxInstance.container.innerHTML="",e._sandboxInstance=null})}).catch(function(t){e._sandboxInstance._cleanInnerContainer()})},a._getErrorLabel=function(e){var t=Sandbox.VHError.ACCESS_ERROR_LABELS;for(var n in t)if(e===t[n].code)return n;return""},a._augmentVHQueryConfig=function(e){var t=e||{};if(!("adsdk-container-width"in t&&"adsdk-container-height"in t)){var n=this._container.getBoundingClientRect();t["adsdk-container-width"]=n.width,
t["adsdk-container-height"]=n.height}return t},r._loadCSS=function(){var e=Sandbox.StaticLinks.BUCKET,n=e.url;e.version&&(n+="/"+e.version+"/"),n+="pages-common/vh-player-js/_vh-player-js.css";var r=t.createElement("link");r.rel="stylesheet",r.href=n,t.getElementsByTagName("head")[0].appendChild(r)},r._loadCSS()},!0);